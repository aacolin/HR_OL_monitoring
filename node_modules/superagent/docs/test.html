<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>SuperAgent â€” elegant API for AJAX in Node and browsers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/aja***REMOVED***/libs/tocbot/3.0.0/tocbot.css">
    <link rel="stylesheet" href="docs/style.css">
  </head>
  <body>
    <ul id="menu"></ul>
    <div id="content">
    <section class="suite">
      <h1>Agent</h1>
      <dl>
        <dt>should remember defaults</dt>
        <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
let called = 0;
let event_called = 0;
const agent = request
  .agent()
  .accept(&#***REMOVED***27;json&#***REMOVED***27;)
  .use(() =&#***REMOVED***3E; {
    called++;
  })
  .once(&#***REMOVED***27;request&#***REMOVED***27;, () =&#***REMOVED***3E; {
    event_called++;
  })
  .query({ hello: &#***REMOVED***27;world&#***REMOVED***27; })
  .set(&#***REMOVED***27;X-test&#***REMOVED***27;, &#***REMOVED***27;testing&#***REMOVED***27;);
assert.equal(0, called);
assert.equal(0, event_called);
return agent
  .get(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
  .then(res =&#***REMOVED***3E; {
    assert.equal(1, called);
    assert.equal(1, event_called);
    assert.equal(&#***REMOVED***27;application/json&#***REMOVED***27;, res.headers.accept);
    assert.equal(&#***REMOVED***27;testing&#***REMOVED***27;, res.headers[&#***REMOVED***27;***REMOVED***-test&#***REMOVED***27;]);
    return agent.get(&#***REMOVED***60;${base}/querystring&#***REMOVED***60;);
  })
  .then(res =&#***REMOVED***3E; {
    assert.equal(2, called);
    assert.equal(2, event_called);
    assert.deepEqual({ hello: &#***REMOVED***27;world&#***REMOVED***27; }, res.body);
  });</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>res.statusCode</h1>
          <dl>
            <dt>should set statusCode</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
        try {
          assert.strictEqual(res.statusCode, 200);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>should allow the send shorthand</h1>
          <dl>
            <dt>with callback in the method call</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
        assert.equal(res.status, 200);
        done();
      });
    }</code></pre></dd>
            <dt>with data in the method call</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;, { foo: &#***REMOVED***27;bar&#***REMOVED***27; }).end((err, res) =&#***REMOVED***3E; {
        assert.equal(&#***REMOVED***27;{&#***REMOVED***22;foo&#***REMOVED***22;:&#***REMOVED***22;bar&#***REMOVED***22;}&#***REMOVED***27;, res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
            <dt>with callback and data in the method call</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;, { foo: &#***REMOVED***27;bar&#***REMOVED***27; }, (err, res) =&#***REMOVED***3E; {
        assert.equal(&#***REMOVED***27;{&#***REMOVED***22;foo&#***REMOVED***22;:&#***REMOVED***22;bar&#***REMOVED***22;}&#***REMOVED***27;, res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with a callback</h1>
          <dl>
            <dt>should invoke .end()</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(res.status, 200);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.end()</h1>
          <dl>
            <dt>should issue a request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(res.status, 200);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
            <dt>is optional with a promise</dt>
            <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
return request
  .get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;)
  .then(res =&#***REMOVED***3E; res.status)
  .then()
  .then(status =&#***REMOVED***3E; {
    assert.equal(200, status, &#***REMOVED***27;Real promises pass results through&#***REMOVED***27;);
  });</code></pre></dd>
            <dt>called only once with a promise</dt>
            <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
const req = request.get(&#***REMOVED***60;${uri}/unique&#***REMOVED***60;);
return Promise.all([req, req, req]).then(results =&#***REMOVED***3E; {
  results.forEach(item =&#***REMOVED***3E; {
    assert.equal(
      item.body,
      results[0].body,
      &#***REMOVED***27;It should keep returning the same result after being called once&#***REMOVED***27;
    );
  });
});</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.error</h1>
          <dl>
            <dt>ok</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      let calledErrorEvent = false;
      let calledOKHandler = false;
      request
        .get(&#***REMOVED***60;${uri}/error&#***REMOVED***60;)
        .ok(res =&#***REMOVED***3E; {
          assert.strictEqual(500, res.status);
          calledOKHandler = true;
          return true;
        })
        .on(&#***REMOVED***27;error&#***REMOVED***27;, err =&#***REMOVED***3E; {
          calledErrorEvent = true;
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.ifError(err);
            assert.strictEqual(res.status, 500);
            assert(!calledErrorEvent);
            assert(calledOKHandler);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should should be an Error object</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      let calledErrorEvent = false;
      request
        .get(&#***REMOVED***60;${uri}/error&#***REMOVED***60;)
        .on(&#***REMOVED***27;error&#***REMOVED***27;, err =&#***REMOVED***3E; {
          assert.strictEqual(err.status, 500);
          calledErrorEvent = true;
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            if (NODE) {
              res.error.message.should.equal(&#***REMOVED***27;cannot GET /error (500)&#***REMOVED***27;);
            } else {
              res.error.message.should.equal(&#***REMOVED***60;cannot GET ${uri}/error (500)&#***REMOVED***60;);
            }
            assert.strictEqual(res.error.status, 500);
            assert(err, &#***REMOVED***27;should have an error for 500&#***REMOVED***27;);
            assert.equal(err.message, &#***REMOVED***27;Internal Server Error&#***REMOVED***27;);
            assert(calledErrorEvent);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>with .then() promise</dt>
            <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
return request.get(&#***REMOVED***60;${uri}/error&#***REMOVED***60;).then(
  () =&#***REMOVED***3E; {
    assert.fail();
  },
  err =&#***REMOVED***3E; {
    assert.equal(err.message, &#***REMOVED***27;Internal Server Error&#***REMOVED***27;);
  }
);</code></pre></dd>
            <dt>with .ok() returning false</dt>
            <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
return request
  .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
  .ok(() =&#***REMOVED***3E; false)
  .then(
    () =&#***REMOVED***3E; {
      assert.fail();
    },
    err =&#***REMOVED***3E; {
      assert.equal(200, err.response.status);
      assert.equal(err.message, &#***REMOVED***27;OK&#***REMOVED***27;);
    }
  );</code></pre></dd>
            <dt>with .ok() throwing an Error</dt>
            <dd><pre><code>if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
  return;
}
return request
  .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
  .ok(() =&#***REMOVED***3E; {
    throw new Error(&#***REMOVED***27;boom&#***REMOVED***27;);
  })
  .then(
    () =&#***REMOVED***3E; {
      assert.fail();
    },
    err =&#***REMOVED***3E; {
      assert.equal(200, err.response.status);
      assert.equal(err.message, &#***REMOVED***27;boom&#***REMOVED***27;);
    }
  );</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.header</h1>
          <dl>
            <dt>should be an object</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;E***REMOVED***press&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-powered-by&#***REMOVED***27;]);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>set headers</h1>
          <dl>
            <dt>should only set headers for ownProperties of header</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      try {
        request
          .get(&#***REMOVED***60;${uri}/echo-headers&#***REMOVED***60;)
          .set(&#***REMOVED***27;valid&#***REMOVED***27;, &#***REMOVED***27;ok&#***REMOVED***27;)
          .end((err, res) =&#***REMOVED***3E; {
            if (
              !err &#***REMOVED***26;&#***REMOVED***26;
              res.body &#***REMOVED***26;&#***REMOVED***26;
              res.body.valid &#***REMOVED***26;&#***REMOVED***26;
              !res.body.hasOwnProperty(&#***REMOVED***27;invalid&#***REMOVED***27;)
            ) {
              return done();
            }
            done(err || new Error(&#***REMOVED***27;fail&#***REMOVED***27;));
          });
      } catch (err) {
        done(err);
      }
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.charset</h1>
          <dl>
            <dt>should be set when present</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          res.charset.should.equal(&#***REMOVED***27;utf-8&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.statusType</h1>
          <dl>
            <dt>should provide the first digit</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          assert(!err, &#***REMOVED***27;should not have an error for success responses&#***REMOVED***27;);
          assert.equal(200, res.status);
          assert.equal(2, res.statusType);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.type</h1>
          <dl>
            <dt>should provide the mime-type void of params</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/login&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          res.type.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
          res.charset.should.equal(&#***REMOVED***27;utf-8&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.set(field, val)</h1>
          <dl>
            <dt>should set the header field</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .set(&#***REMOVED***27;X-Foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
        .set(&#***REMOVED***27;X-Bar&#***REMOVED***27;, &#***REMOVED***27;baz&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-foo&#***REMOVED***27;]);
            assert.equal(&#***REMOVED***27;baz&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-bar&#***REMOVED***27;]);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.set(obj)</h1>
          <dl>
            <dt>should set the header fields</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .set({ &#***REMOVED***27;X-Foo&#***REMOVED***27;: &#***REMOVED***27;bar&#***REMOVED***27;, &#***REMOVED***27;X-Bar&#***REMOVED***27;: &#***REMOVED***27;baz&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-foo&#***REMOVED***27;]);
            assert.equal(&#***REMOVED***27;baz&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-bar&#***REMOVED***27;]);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.type(str)</h1>
          <dl>
            <dt>should set the Content-Type</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;te***REMOVED***t/***REMOVED***-foo&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].should.equal(&#***REMOVED***27;te***REMOVED***t/***REMOVED***-foo&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should map &#***REMOVED***22;json&#***REMOVED***22;</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;json&#***REMOVED***27;)
        .send(&#***REMOVED***27;{&#***REMOVED***22;a&#***REMOVED***22;: 1}&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.should.be.json();
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should map &#***REMOVED***22;html&#***REMOVED***22;</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;html&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.accept(str)</h1>
          <dl>
            <dt>should set Accept</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .accept(&#***REMOVED***27;te***REMOVED***t/***REMOVED***-foo&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.header.accept.should.equal(&#***REMOVED***27;te***REMOVED***t/***REMOVED***-foo&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should map &#***REMOVED***22;json&#***REMOVED***22;</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .accept(&#***REMOVED***27;json&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.header.accept.should.equal(&#***REMOVED***27;application/json&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should map &#***REMOVED***22;***REMOVED***ml&#***REMOVED***22;</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .accept(&#***REMOVED***27;***REMOVED***ml&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            // Mime module keeps changing this :(
            assert(
              res.header.accept == &#***REMOVED***27;application/***REMOVED***ml&#***REMOVED***27; ||
                res.header.accept == &#***REMOVED***27;te***REMOVED***t/***REMOVED***ml&#***REMOVED***27;
            );
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should map &#***REMOVED***22;html&#***REMOVED***22;</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .accept(&#***REMOVED***27;html&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.header.accept.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.send(str)</h1>
          <dl>
            <dt>should write the string</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;json&#***REMOVED***27;)
        .send(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.send(Object)</h1>
          <dl>
            <dt>should default to json</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.should.be.json();
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <section class="suite">
              <h1>when called several times</h1>
              <dl>
                <dt>should merge the objects</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        request
          .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
          .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
          .send({ age: 1 })
          .end((err, res) =&#***REMOVED***3E; {
            try {
              res.should.be.json();
              if (NODE) {
                res.buffered.should.be.true();
              }
              res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;,&#***REMOVED***22;age&#***REMOVED***22;:1}&#***REMOVED***27;);
              done();
            } catch (err2) {
              done(err2);
            }
          });
      }</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
        <section class="suite">
          <h1>.end(fn)</h1>
          <dl>
            <dt>should check arity</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.ifError(err);
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should emit request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;);
      req.on(&#***REMOVED***27;request&#***REMOVED***27;, request =&#***REMOVED***3E; {
        assert.equal(req, request);
        done();
      });
      req.end();
    }</code></pre></dd>
            <dt>should emit response</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .on(&#***REMOVED***27;response&#***REMOVED***27;, res =&#***REMOVED***3E; {
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
          done();
        })
        .end();
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.then(fulfill, reject)</h1>
          <dl>
            <dt>should support successful fulfills with .then(fulfill)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
        return done();
      }
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .then(res =&#***REMOVED***3E; {
          res.type.should.equal(&#***REMOVED***27;application/json&#***REMOVED***27;);
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should reject an error with .then(null, reject)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
        return done();
      }
      request.get(&#***REMOVED***60;${uri}/error&#***REMOVED***60;).then(null, err =&#***REMOVED***3E; {
        assert.equal(err.status, 500);
        assert.equal(err.response.te***REMOVED***t, &#***REMOVED***27;boom&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.catch(reject)</h1>
          <dl>
            <dt>should reject an error with .catch(reject)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      if (typeof Promise === &#***REMOVED***27;undefined&#***REMOVED***27;) {
        return done();
      }
      request.get(&#***REMOVED***60;${uri}/error&#***REMOVED***60;).catch(err =&#***REMOVED***3E; {
        assert.equal(err.status, 500);
        assert.equal(err.response.te***REMOVED***t, &#***REMOVED***27;boom&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.abort()</h1>
          <dl>
            <dt>should abort the request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${uri}/delay/3000&#***REMOVED***60;);
      req.end((err, res) =&#***REMOVED***3E; {
        try {
          assert(false, &#***REMOVED***27;should not complete the request&#***REMOVED***27;);
        } catch (err2) {
          done(err2);
        }
      });
      req.on(&#***REMOVED***27;error&#***REMOVED***27;, error =&#***REMOVED***3E; {
        done(error);
      });
      req.on(&#***REMOVED***27;abort&#***REMOVED***27;, done);
      setTimeout(() =&#***REMOVED***3E; {
        req.abort();
      }, 500);
    }</code></pre></dd>
            <dt>should abort the promise</dt>
            <dd><pre><code>const req = request.get(&#***REMOVED***60;${uri}/delay/3000&#***REMOVED***60;);
setTimeout(() =&#***REMOVED***3E; {
  req.abort();
}, 10);
return req.then(
  () =&#***REMOVED***3E; {
    assert.fail(&#***REMOVED***27;should not complete the request&#***REMOVED***27;);
  },
  err =&#***REMOVED***3E; {
    assert.equal(&#***REMOVED***27;ABORTED&#***REMOVED***27;, err.code);
  }
);</code></pre></dd>
            <dt>should allow chaining .abort() several times</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${uri}/delay/3000&#***REMOVED***60;);
      req.end((err, res) =&#***REMOVED***3E; {
        try {
          assert(false, &#***REMOVED***27;should not complete the request&#***REMOVED***27;);
        } catch (err2) {
          done(err2);
        }
      });
      // This also verifies only a single &#***REMOVED***27;done&#***REMOVED***27; event is emitted
      req.on(&#***REMOVED***27;abort&#***REMOVED***27;, done);
      setTimeout(() =&#***REMOVED***3E; {
        req
          .abort()
          .abort()
          .abort();
      }, 1000);
    }</code></pre></dd>
            <dt>should not allow abort then end</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/delay/3000&#***REMOVED***60;)
        .abort()
        .end((err, res) =&#***REMOVED***3E; {
          done(err ? undefined : new Error(&#***REMOVED***27;E***REMOVED***pected abort error&#***REMOVED***27;));
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.toJSON()</h1>
          <dl>
            <dt>should describe the request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;).send({ foo: &#***REMOVED***27;baz&#***REMOVED***27; });
      req.end((err, res) =&#***REMOVED***3E; {
        try {
          const json = req.toJSON();
          assert.equal(&#***REMOVED***27;POST&#***REMOVED***27;, json.method);
          assert(/\/echo$/.test(json.url));
          assert.equal(&#***REMOVED***27;baz&#***REMOVED***27;, json.data.foo);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.options()</h1>
          <dl>
            <dt>should allow request body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .options(&#***REMOVED***60;${uri}/options/echo/body&#***REMOVED***60;)
        .send({ foo: &#***REMOVED***27;baz&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(err, null);
            assert.strictEqual(res.body.foo, &#***REMOVED***27;baz&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.sortQuery()</h1>
          <dl>
            <dt>nop with no querystring</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/url&#***REMOVED***60;)
        .sortQuery()
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(res.te***REMOVED***t, &#***REMOVED***27;/url&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should sort the request querystring</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/url&#***REMOVED***60;)
        .query(&#***REMOVED***27;search=Manny&#***REMOVED***27;)
        .query(&#***REMOVED***27;order=desc&#***REMOVED***27;)
        .sortQuery()
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(res.te***REMOVED***t, &#***REMOVED***27;/url?order=desc&#***REMOVED***26;search=Manny&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should allow disabling sorting</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/url&#***REMOVED***60;)
        .query(&#***REMOVED***27;search=Manny&#***REMOVED***27;)
        .query(&#***REMOVED***27;order=desc&#***REMOVED***27;)
        .sortQuery() // take default of true
        .sortQuery(false) // override it in later call
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(res.te***REMOVED***t, &#***REMOVED***27;/url?search=Manny&#***REMOVED***26;order=desc&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should sort the request querystring using customized function</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/url&#***REMOVED***60;)
        .query(&#***REMOVED***27;name=Nick&#***REMOVED***27;)
        .query(&#***REMOVED***27;search=Manny&#***REMOVED***27;)
        .query(&#***REMOVED***27;order=desc&#***REMOVED***27;)
        .sortQuery((a, b) =&#***REMOVED***3E; a.length - b.length)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(res.te***REMOVED***t, &#***REMOVED***27;/url?name=Nick&#***REMOVED***26;order=desc&#***REMOVED***26;search=Manny&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>req.set(&#***REMOVED***22;Content-Type&#***REMOVED***22;, contentType)</h1>
      <dl>
        <dt>should work with just the contentType component</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/json&#***REMOVED***27;)
      .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        assert(!err);
        done();
      });
  }</code></pre></dd>
        <dt>should work with the charset component</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/json; charset=utf-8&#***REMOVED***27;)
      .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        assert(!err);
        done();
      });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.send(Object) as &#***REMOVED***22;form&#***REMOVED***22;</h1>
      <dl>
        <section class="suite">
          <h1>with req.type() set to form</h1>
          <dl>
            <dt>should send ***REMOVED***-www-form-urlencoded data</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;form&#***REMOVED***27;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].should.equal(
            &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;
          );
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;name=tobi&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>when called several times</h1>
          <dl>
            <dt>should merge the objects</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;form&#***REMOVED***27;)
        .send({ name: { first: &#***REMOVED***27;tobi&#***REMOVED***27;, last: &#***REMOVED***27;holowaychuk&#***REMOVED***27; } })
        .send({ age: &#***REMOVED***27;1&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].should.equal(
            &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;
          );
          res.te***REMOVED***t.should.equal(
            &#***REMOVED***27;name%5Bfirst%5D=tobi&#***REMOVED***26;name%5Blast%5D=holowaychuk&#***REMOVED***26;age=1&#***REMOVED***27;
          );
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>req.attach</h1>
      <dl>
        <dt>ignores null file</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***27;/echo&#***REMOVED***27;)
      .attach(&#***REMOVED***27;image&#***REMOVED***27;, null)
      .end((err, res) =&#***REMOVED***3E; {
        done();
      });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.field</h1>
      <dl>
        <dt>allow bools</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    if (!formDataSupported) {
      return done();
    }
    request
      .post(&#***REMOVED***60;${base}/formecho&#***REMOVED***60;)
      .field(&#***REMOVED***27;bools&#***REMOVED***27;, true)
      .field(&#***REMOVED***27;strings&#***REMOVED***27;, &#***REMOVED***27;true&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        assert.ifError(err);
        assert.deepStrictEqual(res.body, { bools: &#***REMOVED***27;true&#***REMOVED***27;, strings: &#***REMOVED***27;true&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>allow objects</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    if (!formDataSupported) {
      return done();
    }
    request
      .post(&#***REMOVED***60;${base}/formecho&#***REMOVED***60;)
      .field({ bools: true, strings: &#***REMOVED***27;true&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        assert.ifError(err);
        assert.deepStrictEqual(res.body, { bools: &#***REMOVED***27;true&#***REMOVED***27;, strings: &#***REMOVED***27;true&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>works with arrays in objects</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    if (!formDataSupported) {
      return done();
    }
    request
      .post(&#***REMOVED***60;${base}/formecho&#***REMOVED***60;)
      .field({ numbers: [1, 2, 3] })
      .end((err, res) =&#***REMOVED***3E; {
        assert.ifError(err);
        assert.deepStrictEqual(res.body, { numbers: [&#***REMOVED***27;1&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;, &#***REMOVED***27;3&#***REMOVED***27;] });
        done();
      });
  }</code></pre></dd>
        <dt>works with arrays</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    if (!formDataSupported) {
      return done();
    }
    request
      .post(&#***REMOVED***60;${base}/formecho&#***REMOVED***60;)
      .field(&#***REMOVED***27;letters&#***REMOVED***27;, [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;])
      .end((err, res) =&#***REMOVED***3E; {
        assert.ifError(err);
        assert.deepStrictEqual(res.body, { letters: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;] });
        done();
      });
  }</code></pre></dd>
        <dt>throw when empty</dt>
        <dd><pre><code>should.throws(() =&#***REMOVED***3E; {
  request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;).field();
}, /name/);
should.throws(() =&#***REMOVED***3E; {
  request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;).field(&#***REMOVED***27;name&#***REMOVED***27;);
}, /val/);</code></pre></dd>
        <dt>cannot be mi***REMOVED***ed with send()</dt>
        <dd><pre><code>assert.throws(() =&#***REMOVED***3E; {
  request
    .post(&#***REMOVED***27;/echo&#***REMOVED***27;)
    .field(&#***REMOVED***27;form&#***REMOVED***27;, &#***REMOVED***27;data&#***REMOVED***27;)
    .send(&#***REMOVED***27;hi&#***REMOVED***27;);
});
assert.throws(() =&#***REMOVED***3E; {
  request
    .post(&#***REMOVED***27;/echo&#***REMOVED***27;)
    .send(&#***REMOVED***27;hi&#***REMOVED***27;)
    .field(&#***REMOVED***27;form&#***REMOVED***27;, &#***REMOVED***27;data&#***REMOVED***27;);
});</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.send(Object) as &#***REMOVED***22;json&#***REMOVED***22;</h1>
      <dl>
        <dt>should default to json</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        res.should.be.json();
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
        done();
      });
  }</code></pre></dd>
        <dt>should work with arrays</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .send([1, 2, 3])
      .end((err, res) =&#***REMOVED***3E; {
        res.should.be.json();
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;[1,2,3]&#***REMOVED***27;);
        done();
      });
  }</code></pre></dd>
        <dt>should work with value null</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .type(&#***REMOVED***27;json&#***REMOVED***27;)
      .send(&#***REMOVED***27;null&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.should.be.json();
        assert.strictEqual(res.body, null);
        done();
      });
  }</code></pre></dd>
        <dt>should work with value false</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .type(&#***REMOVED***27;json&#***REMOVED***27;)
      .send(&#***REMOVED***27;false&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.should.be.json();
        res.body.should.equal(false);
        done();
      });
  }</code></pre></dd>
        <dt>should work with value 0</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
      // fails in IE9
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;json&#***REMOVED***27;)
        .send(&#***REMOVED***27;0&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          res.should.be.json();
          res.body.should.equal(0);
          done();
        });
    }</code></pre></dd>
        <dt>should work with empty string value</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .type(&#***REMOVED***27;json&#***REMOVED***27;)
      .send(&#***REMOVED***27;&#***REMOVED***22;&#***REMOVED***22;&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.should.be.json();
        res.body.should.equal(&#***REMOVED***27;&#***REMOVED***27;);
        done();
      });
  }</code></pre></dd>
        <dt>should work with GET</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ tobi: &#***REMOVED***27;ferret&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            res.should.be.json();
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;tobi&#***REMOVED***22;:&#***REMOVED***22;ferret&#***REMOVED***22;}&#***REMOVED***27;);
            ({ tobi: &#***REMOVED***27;ferret&#***REMOVED***27; }.should.eql(res.body));
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
        <dt>should work with vendor MIME type</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/vnd.e***REMOVED***ample+json&#***REMOVED***27;)
      .send({ name: &#***REMOVED***27;vendor&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;vendor&#***REMOVED***22;}&#***REMOVED***27;);
        ({ name: &#***REMOVED***27;vendor&#***REMOVED***27; }.should.eql(res.body));
        done();
      });
  }</code></pre></dd>
        <section class="suite">
          <h1>when called several times</h1>
          <dl>
            <dt>should merge the objects</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
        .send({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
        .send({ age: 1 })
        .end((err, res) =&#***REMOVED***3E; {
          res.should.be.json();
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;,&#***REMOVED***22;age&#***REMOVED***22;:1}&#***REMOVED***27;);
          ({ name: &#***REMOVED***27;tobi&#***REMOVED***27;, age: 1 }.should.eql(res.body));
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>res.body</h1>
      <dl>
        <section class="suite">
          <h1>application/json</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/json&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;manny&#***REMOVED***22;}&#***REMOVED***27;);
        res.body.should.eql({ name: &#***REMOVED***27;manny&#***REMOVED***27; });
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>HEAD requests</h1>
          <dl>
            <dt>should not throw a parse error</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
        request.head(&#***REMOVED***60;${uri}/json&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
          try {
            assert.strictEqual(err, null);
            assert.strictEqual(res.te***REMOVED***t, undefined);
            assert.strictEqual(Object.keys(res.body).length, 0);
            done();
          } catch (err2) {
            done(err2);
          }
        });
      }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>Invalid JSON response</h1>
          <dl>
            <dt>should return the raw response</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/invalid-json&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert.deepEqual(
          err.rawResponse,
          &#***REMOVED***22;)]}&#***REMOVED***27;, {&#***REMOVED***27;header&#***REMOVED***27;:{&#***REMOVED***27;code&#***REMOVED***27;:200,&#***REMOVED***27;te***REMOVED***t&#***REMOVED***27;:&#***REMOVED***27;OK&#***REMOVED***27;,&#***REMOVED***27;version&#***REMOVED***27;:&#***REMOVED***27;1.0&#***REMOVED***27;},&#***REMOVED***27;data&#***REMOVED***27;:&#***REMOVED***27;some data&#***REMOVED***27;}&#***REMOVED***22;
        );
        done();
      });
    }</code></pre></dd>
            <dt>should return the http status code</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${uri}/invalid-json-forbidden&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert.equal(err.statusCode, 403);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>No content</h1>
          <dl>
            <dt>should not throw a parse error</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
        request.get(&#***REMOVED***60;${uri}/no-content&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
          try {
            assert.strictEqual(err, null);
            assert.strictEqual(res.te***REMOVED***t, &#***REMOVED***27;&#***REMOVED***27;);
            assert.strictEqual(Object.keys(res.body).length, 0);
            done();
          } catch (err2) {
            done(err2);
          }
        });
      }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>application/json+hal</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
        request.get(&#***REMOVED***60;${uri}/json-hal&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
          if (err) return done(err);
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;hal 5000&#***REMOVED***22;}&#***REMOVED***27;);
          res.body.should.eql({ name: &#***REMOVED***27;hal 5000&#***REMOVED***27; });
          done();
        });
      }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>vnd.collection+json</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
        request.get(&#***REMOVED***60;${uri}/collection-json&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;chewbacca&#***REMOVED***22;}&#***REMOVED***27;);
          res.body.should.eql({ name: &#***REMOVED***27;chewbacca&#***REMOVED***27; });
          done();
        });
      }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>on redirect</h1>
          <dl>
            <dt>should retain header fields</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/header&#***REMOVED***60;)
        .set(&#***REMOVED***27;X-Foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert(res.body);
            res.body.should.have.property(&#***REMOVED***27;***REMOVED***-foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should preserve timeout across redirects</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/movies/random&#***REMOVED***60;)
        .timeout(250)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert(err instanceof Error, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
            err.should.have.property(&#***REMOVED***27;timeout&#***REMOVED***27;, 250);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should successfully redirect after retry on error</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const id = Math.random() * 1000000 * Date.now();
      request
        .get(&#***REMOVED***60;${base}/error/redirect/${id}&#***REMOVED***60;)
        .retry(2)
        .end((err, res) =&#***REMOVED***3E; {
          assert(res.ok, &#***REMOVED***27;response should be ok&#***REMOVED***27;);
          assert(res.te***REMOVED***t, &#***REMOVED***27;first movie page&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should preserve retries across redirects</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const id = Math.random() * 1000000 * Date.now();
      request
        .get(&#***REMOVED***60;${base}/error/redirect-error${id}&#***REMOVED***60;)
        .retry(2)
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(2, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 303</h1>
          <dl>
            <dt>should redirect with same method</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .put(&#***REMOVED***60;${base}/redirect-303&#***REMOVED***60;)
        .send({ msg: &#***REMOVED***27;hello&#***REMOVED***27; })
        .redirects(1)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          res.headers.location.should.equal(&#***REMOVED***27;/reply-method&#***REMOVED***27;);
        })
        .end((err, res) =&#***REMOVED***3E; {
          if (err) {
            done(err);
            return;
          }
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;method=get&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 307</h1>
          <dl>
            <dt>should redirect with same method</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      if (isMSIE) return done(); // IE9 broken
      request
        .put(&#***REMOVED***60;${base}/redirect-307&#***REMOVED***60;)
        .send({ msg: &#***REMOVED***27;hello&#***REMOVED***27; })
        .redirects(1)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          res.headers.location.should.equal(&#***REMOVED***27;/reply-method&#***REMOVED***27;);
        })
        .end((err, res) =&#***REMOVED***3E; {
          if (err) {
            done(err);
            return;
          }
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;method=put&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 308</h1>
          <dl>
            <dt>should redirect with same method</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      if (isMSIE) return done(); // IE9 broken
      request
        .put(&#***REMOVED***60;${base}/redirect-308&#***REMOVED***60;)
        .send({ msg: &#***REMOVED***27;hello&#***REMOVED***27; })
        .redirects(1)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          res.headers.location.should.equal(&#***REMOVED***27;/reply-method&#***REMOVED***27;);
        })
        .end((err, res) =&#***REMOVED***3E; {
          if (err) {
            done(err);
            return;
          }
          res.te***REMOVED***t.should.equal(&#***REMOVED***27;method=put&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <dt>Request inheritance</dt>
        <dd><pre><code>assert(request.get(&#***REMOVED***60;${uri}/&#***REMOVED***60;) instanceof request.Request);</code></pre></dd>
        <dt>request() simple GET without callback</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***27;test/test.request.js&#***REMOVED***27;).end();
    ne***REMOVED***t();
  }</code></pre></dd>
        <dt>request() simple GET</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/ok&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(res instanceof request.Response, &#***REMOVED***27;respond with Response&#***REMOVED***27;);
        assert(res.ok, &#***REMOVED***27;response should be ok&#***REMOVED***27;);
        assert(res.te***REMOVED***t, &#***REMOVED***27;res.te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() simple HEAD</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.head(&#***REMOVED***60;${uri}/ok&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(res instanceof request.Response, &#***REMOVED***27;respond with Response&#***REMOVED***27;);
        assert(res.ok, &#***REMOVED***27;response should be ok&#***REMOVED***27;);
        assert(!res.te***REMOVED***t, &#***REMOVED***27;res.te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 5***REMOVED******REMOVED***</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/error&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert.equal(err.message, &#***REMOVED***27;Internal Server Error&#***REMOVED***27;);
        assert(!res.ok, &#***REMOVED***27;response should not be ok&#***REMOVED***27;);
        assert(res.error, &#***REMOVED***27;response should be an error&#***REMOVED***27;);
        assert(!res.clientError, &#***REMOVED***27;response should not be a client error&#***REMOVED***27;);
        assert(res.serverError, &#***REMOVED***27;response should be a server error&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 4***REMOVED******REMOVED***</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert.equal(err.message, &#***REMOVED***27;Not Found&#***REMOVED***27;);
        assert(!res.ok, &#***REMOVED***27;response should not be ok&#***REMOVED***27;);
        assert(res.error, &#***REMOVED***27;response should be an error&#***REMOVED***27;);
        assert(res.clientError, &#***REMOVED***27;response should be a client error&#***REMOVED***27;);
        assert(!res.serverError, &#***REMOVED***27;response should not be a server error&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 404 Not Found</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert(res.notFound, &#***REMOVED***27;response should be .notFound&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 400 Bad Request</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/bad-request&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert(res.badRequest, &#***REMOVED***27;response should be .badRequest&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 401 Bad Request</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/unauthorized&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert(res.unauthorized, &#***REMOVED***27;response should be .unauthorized&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 406 Not Acceptable</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/not-acceptable&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert(res.notAcceptable, &#***REMOVED***27;response should be .notAcceptable&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() GET 204 No Content</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/no-content&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.ifError(err);
        assert(res.noContent, &#***REMOVED***27;response should be .noContent&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() DELETE 204 No Content</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;DELETE&#***REMOVED***27;, &#***REMOVED***60;${uri}/no-content&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.ifError(err);
        assert(res.noContent, &#***REMOVED***27;response should be .noContent&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() header parsing</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert.equal(&#***REMOVED***27;te***REMOVED***t/html; charset=utf-8&#***REMOVED***27;, res.header[&#***REMOVED***27;content-type&#***REMOVED***27;]);
        assert.equal(&#***REMOVED***27;E***REMOVED***press&#***REMOVED***27;, res.header[&#***REMOVED***27;***REMOVED***-powered-by&#***REMOVED***27;]);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request() .status</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert.equal(404, res.status, &#***REMOVED***27;response .status&#***REMOVED***27;);
        assert.equal(4, res.statusType, &#***REMOVED***27;response .statusType&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>get()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err);
        assert.equal(404, res.status, &#***REMOVED***27;response .status&#***REMOVED***27;);
        assert.equal(4, res.statusType, &#***REMOVED***27;response .statusType&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>put()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.put(&#***REMOVED***60;${uri}/user/12&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;updated&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>put().send()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .put(&#***REMOVED***60;${uri}/user/13/body&#***REMOVED***60;)
      .send({ user: &#***REMOVED***27;new&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;received new&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>post()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.post(&#***REMOVED***60;${uri}/user&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;created&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>del()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.del(&#***REMOVED***60;${uri}/user/12&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;deleted&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>delete()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.delete(&#***REMOVED***60;${uri}/user/12&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;deleted&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>post() data</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/todo/item&#***REMOVED***60;)
      .type(&#***REMOVED***27;application/octet-stream&#***REMOVED***27;)
      .send(&#***REMOVED***27;tobi&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added &#***REMOVED***22;tobi&#***REMOVED***22;&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .type()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/user/12/pet&#***REMOVED***60;)
      .type(&#***REMOVED***27;urlencoded&#***REMOVED***27;)
      .send(&#***REMOVED***27;pet=tobi&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added pet &#***REMOVED***22;tobi&#***REMOVED***22;&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .type() with alias</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/user/12/pet&#***REMOVED***60;)
      .type(&#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;)
      .send(&#***REMOVED***27;pet=tobi&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added pet &#***REMOVED***22;tobi&#***REMOVED***22;&#***REMOVED***27;, res.te***REMOVED***t, &#***REMOVED***27;response te***REMOVED***t&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .get() with no data or callback</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/echo-header/content-type&#***REMOVED***60;);
    ne***REMOVED***t();
  }</code></pre></dd>
        <dt>request .send() with no data only</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/user/5/pet&#***REMOVED***60;)
      .type(&#***REMOVED***27;urlencoded&#***REMOVED***27;)
      .send(&#***REMOVED***27;pet=tobi&#***REMOVED***27;);
    ne***REMOVED***t();
  }</code></pre></dd>
        <dt>request .send() with callback only</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/echo-header/accept&#***REMOVED***60;)
      .set(&#***REMOVED***27;Accept&#***REMOVED***27;, &#***REMOVED***27;foo/bar&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;foo/bar&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .accept() with json</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/echo-header/accept&#***REMOVED***60;)
      .accept(&#***REMOVED***27;json&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;application/json&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .accept() with application/json</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/echo-header/accept&#***REMOVED***60;)
      .accept(&#***REMOVED***27;application/json&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;application/json&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .accept() with ***REMOVED***ml</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/echo-header/accept&#***REMOVED***60;)
      .accept(&#***REMOVED***27;***REMOVED***ml&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          // We can&#***REMOVED***27;t depend on mime module to be consistent with this
          assert(res.te***REMOVED***t == &#***REMOVED***27;application/***REMOVED***ml&#***REMOVED***27; || res.te***REMOVED***t == &#***REMOVED***27;te***REMOVED***t/***REMOVED***ml&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .accept() with application/***REMOVED***ml</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/echo-header/accept&#***REMOVED***60;)
      .accept(&#***REMOVED***27;application/***REMOVED***ml&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;application/***REMOVED***ml&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .end()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .put(&#***REMOVED***60;${uri}/echo-header/content-type&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;)
      .send(&#***REMOVED***27;wahoo&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .send()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .put(&#***REMOVED***60;${uri}/echo-header/content-type&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;)
      .send(&#***REMOVED***27;wahoo&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .set()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .put(&#***REMOVED***60;${uri}/echo-header/content-type&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;)
      .send(&#***REMOVED***27;wahoo&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>request .set(object)</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .put(&#***REMOVED***60;${uri}/echo-header/content-type&#***REMOVED***60;)
      .set({ &#***REMOVED***27;Content-Type&#***REMOVED***27;: &#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27; })
      .send(&#***REMOVED***27;wahoo&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST urlencoded</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/pet&#***REMOVED***60;)
      .type(&#***REMOVED***27;urlencoded&#***REMOVED***27;)
      .send({ name: &#***REMOVED***27;Manny&#***REMOVED***27;, species: &#***REMOVED***27;cat&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added Manny the cat&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST json</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/pet&#***REMOVED***60;)
      .type(&#***REMOVED***27;json&#***REMOVED***27;)
      .send({ name: &#***REMOVED***27;Manny&#***REMOVED***27;, species: &#***REMOVED***27;cat&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added Manny the cat&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST json array</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .send([1, 2, 3])
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(
            &#***REMOVED***27;application/json&#***REMOVED***27;,
            res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].split(&#***REMOVED***27;;&#***REMOVED***27;)[0]
          );
          assert.equal(&#***REMOVED***27;[1,2,3]&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST json default</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/pet&#***REMOVED***60;)
      .send({ name: &#***REMOVED***27;Manny&#***REMOVED***27;, species: &#***REMOVED***27;cat&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added Manny the cat&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST json contentType charset</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/json; charset=UTF-8&#***REMOVED***27;)
      .send({ data: [&#***REMOVED***27;data1&#***REMOVED***27;, &#***REMOVED***27;data2&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;{&#***REMOVED***22;data&#***REMOVED***22;:[&#***REMOVED***22;data1&#***REMOVED***22;,&#***REMOVED***22;data2&#***REMOVED***22;]}&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST json contentType vendor</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/vnd.e***REMOVED***ample+json&#***REMOVED***27;)
      .send({ data: [&#***REMOVED***27;data1&#***REMOVED***27;, &#***REMOVED***27;data2&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;{&#***REMOVED***22;data&#***REMOVED***22;:[&#***REMOVED***22;data1&#***REMOVED***22;,&#***REMOVED***22;data2&#***REMOVED***22;]}&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST multiple .send() calls</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/pet&#***REMOVED***60;)
      .send({ name: &#***REMOVED***27;Manny&#***REMOVED***27; })
      .send({ species: &#***REMOVED***27;cat&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;added Manny the cat&#***REMOVED***27;, res.te***REMOVED***t);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST multiple .send() strings</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/echo&#***REMOVED***60;)
      .send(&#***REMOVED***27;user[name]=tj&#***REMOVED***27;)
      .send(&#***REMOVED***27;user[email]=tj@vision-media.ca&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(
            &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;,
            res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].split(&#***REMOVED***27;;&#***REMOVED***27;)[0]
          );
          assert.equal(
            res.te***REMOVED***t,
            &#***REMOVED***27;user[name]=tj&#***REMOVED***26;user[email]=tj@vision-media.ca&#***REMOVED***27;
          );
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>POST with no data</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${uri}/empty-body&#***REMOVED***60;)
      .send()
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.ifError(err);
          assert(res.noContent, &#***REMOVED***27;response should be .noContent&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET .type</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/pets&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;application/json&#***REMOVED***27;, res.type);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>GET Content-Type params</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/te***REMOVED***t&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;utf-8&#***REMOVED***27;, res.charset);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>GET json</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/pets&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.deepEqual(res.body, [&#***REMOVED***27;tobi&#***REMOVED***27;, &#***REMOVED***27;loki&#***REMOVED***27;, &#***REMOVED***27;jane&#***REMOVED***27;]);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>GET json-seq</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/json-seq&#***REMOVED***60;)
      .buffer()
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.ifError(err);
          assert.deepEqual(res.te***REMOVED***t, &#***REMOVED***27;\u001E{&#***REMOVED***22;id&#***REMOVED***22;:1}\n\u001E{&#***REMOVED***22;id&#***REMOVED***22;:2}\n&#***REMOVED***27;);
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET ***REMOVED***-www-form-urlencoded</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.deepEqual(res.body, { foo: &#***REMOVED***27;bar&#***REMOVED***27; });
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>GET shorthand</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;foo=bar&#***REMOVED***27;, res.te***REMOVED***t);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>POST shorthand</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.post(&#***REMOVED***60;${uri}/user/0/pet&#***REMOVED***60;, { pet: &#***REMOVED***27;tobi&#***REMOVED***27; }, (err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;added pet &#***REMOVED***22;tobi&#***REMOVED***22;&#***REMOVED***27;, res.te***REMOVED***t);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>POST shorthand without callback</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.post(&#***REMOVED***60;${uri}/user/0/pet&#***REMOVED***60;, { pet: &#***REMOVED***27;tobi&#***REMOVED***27; }).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;added pet &#***REMOVED***22;tobi&#***REMOVED***22;&#***REMOVED***27;, res.te***REMOVED***t);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>GET querystring object with array</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query({ val: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, { val: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;] });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring object with array and primitives</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query({ array: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;], string: &#***REMOVED***27;foo&#***REMOVED***27;, number: 10 })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, {
            array: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;],
            string: &#***REMOVED***27;foo&#***REMOVED***27;,
            number: 10
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring object with two arrays</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query({ array1: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;], array2: [1, 2, 3] })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, {
            array1: [&#***REMOVED***27;a&#***REMOVED***27;, &#***REMOVED***27;b&#***REMOVED***27;, &#***REMOVED***27;c&#***REMOVED***27;],
            array2: [1, 2, 3]
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring object</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query({ search: &#***REMOVED***27;Manny&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, { search: &#***REMOVED***27;Manny&#***REMOVED***27; });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring append original</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring?search=Manny&#***REMOVED***60;)
      .query({ range: &#***REMOVED***27;1..5&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, { search: &#***REMOVED***27;Manny&#***REMOVED***27;, range: &#***REMOVED***27;1..5&#***REMOVED***27; });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring multiple objects</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query({ search: &#***REMOVED***27;Manny&#***REMOVED***27; })
      .query({ range: &#***REMOVED***27;1..5&#***REMOVED***27; })
      .query({ order: &#***REMOVED***27;desc&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, {
            search: &#***REMOVED***27;Manny&#***REMOVED***27;,
            range: &#***REMOVED***27;1..5&#***REMOVED***27;,
            order: &#***REMOVED***27;desc&#***REMOVED***27;
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring with strings</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query(&#***REMOVED***27;search=Manny&#***REMOVED***27;)
      .query(&#***REMOVED***27;range=1..5&#***REMOVED***27;)
      .query(&#***REMOVED***27;order=desc&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, {
            search: &#***REMOVED***27;Manny&#***REMOVED***27;,
            range: &#***REMOVED***27;1..5&#***REMOVED***27;,
            order: &#***REMOVED***27;desc&#***REMOVED***27;
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET querystring with strings and objects</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/querystring&#***REMOVED***60;)
      .query(&#***REMOVED***27;search=Manny&#***REMOVED***27;)
      .query({ order: &#***REMOVED***27;desc&#***REMOVED***27;, range: &#***REMOVED***27;1..5&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, {
            search: &#***REMOVED***27;Manny&#***REMOVED***27;,
            range: &#***REMOVED***27;1..5&#***REMOVED***27;,
            order: &#***REMOVED***27;desc&#***REMOVED***27;
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      });
  }</code></pre></dd>
        <dt>GET shorthand payload goes to querystring</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(
      &#***REMOVED***60;${uri}/querystring&#***REMOVED***60;,
      { foo: &#***REMOVED***27;FOO&#***REMOVED***27;, bar: &#***REMOVED***27;BAR&#***REMOVED***27; },
      (err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(res.body, { foo: &#***REMOVED***27;FOO&#***REMOVED***27;, bar: &#***REMOVED***27;BAR&#***REMOVED***27; });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      }
    );
  }</code></pre></dd>
        <dt>HEAD shorthand payload goes to querystring</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.head(
      &#***REMOVED***60;${uri}/querystring-in-header&#***REMOVED***60;,
      { foo: &#***REMOVED***27;FOO&#***REMOVED***27;, bar: &#***REMOVED***27;BAR&#***REMOVED***27; },
      (err, res) =&#***REMOVED***3E; {
        try {
          assert.deepEqual(JSON.parse(res.headers.query), {
            foo: &#***REMOVED***27;FOO&#***REMOVED***27;,
            bar: &#***REMOVED***27;BAR&#***REMOVED***27;
          });
          ne***REMOVED***t();
        } catch (err2) {
          ne***REMOVED***t(err2);
        }
      }
    );
  }</code></pre></dd>
        <dt>request(method, url)</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***27;GET&#***REMOVED***27;, &#***REMOVED***60;${uri}/foo&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.body.foo);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request(url)</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.body.foo);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request(url, fn)</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
      try {
        assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.body.foo);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>req.timeout(ms)</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    const req = request.get(&#***REMOVED***60;${uri}/delay/3000&#***REMOVED***60;).timeout(1000);
    req.end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err, &#***REMOVED***27;error missing&#***REMOVED***27;);
        assert.equal(1000, err.timeout, &#***REMOVED***27;err.timeout missing&#***REMOVED***27;);
        assert.equal(
          &#***REMOVED***27;Timeout of 1000ms e***REMOVED***ceeded&#***REMOVED***27;,
          err.message,
          &#***REMOVED***27;err.message incorrect&#***REMOVED***27;
        );
        assert.equal(null, res);
        assert(req.timedout, true);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>req.timeout(ms) with redirect</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    const req = request.get(&#***REMOVED***60;${uri}/delay/const&#***REMOVED***60;).timeout(1000);
    req.end((err, res) =&#***REMOVED***3E; {
      try {
        assert(err, &#***REMOVED***27;error missing&#***REMOVED***27;);
        assert.equal(1000, err.timeout, &#***REMOVED***27;err.timeout missing&#***REMOVED***27;);
        assert.equal(
          &#***REMOVED***27;Timeout of 1000ms e***REMOVED***ceeded&#***REMOVED***27;,
          err.message,
          &#***REMOVED***27;err.message incorrect&#***REMOVED***27;
        );
        assert.equal(null, res);
        assert(req.timedout, true);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>request event</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;)
      .on(&#***REMOVED***27;request&#***REMOVED***27;, req =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;, req.url);
          ne***REMOVED***t();
        } catch (err) {
          ne***REMOVED***t(err);
        }
      })
      .end();
  }</code></pre></dd>
        <dt>response event</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${uri}/foo&#***REMOVED***60;)
      .on(&#***REMOVED***27;response&#***REMOVED***27;, res =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;bar&#***REMOVED***27;, res.body.foo);
          ne***REMOVED***t();
        } catch (err) {
          ne***REMOVED***t(err);
        }
      })
      .end();
  }</code></pre></dd>
        <dt>response should set statusCode</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/ok&#***REMOVED***60;, (err, res) =&#***REMOVED***3E; {
      try {
        assert.strictEqual(res.statusCode, 200);
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
        <dt>req.toJSON()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${uri}/ok&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      try {
        const j = (res.request || res.req).toJSON();
        [&#***REMOVED***27;url&#***REMOVED***27;, &#***REMOVED***27;method&#***REMOVED***27;, &#***REMOVED***27;data&#***REMOVED***27;, &#***REMOVED***27;headers&#***REMOVED***27;].forEach(prop =&#***REMOVED***3E; {
          assert(j.hasOwnProperty(prop));
        });
        ne***REMOVED***t();
      } catch (err2) {
        ne***REMOVED***t(err2);
      }
    });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>.retry(count)</h1>
      <dl>
        <dt>should not retry if passed &#***REMOVED***22;0&#***REMOVED***22;</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(0)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            undefined,
            err.retries,
            &#***REMOVED***27;e***REMOVED***pected an error without .retries&#***REMOVED***27;
          );
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should not retry if passed an invalid number</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(-2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            undefined,
            err.retries,
            &#***REMOVED***27;e***REMOVED***pected an error without .retries&#***REMOVED***27;
          );
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should not retry if passed undefined</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(undefined)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            undefined,
            err.retries,
            &#***REMOVED***27;e***REMOVED***pected an error without .retries&#***REMOVED***27;
          );
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should handle server error after repeat attempt</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(2, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should retry if passed nothing</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry()
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(1, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should retry if passed &#***REMOVED***22;true&#***REMOVED***22;</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(true)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(1, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should handle successful request after repeat attempt from server error</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error/ok/${uniqid()}&#***REMOVED***60;)
      .query({ qs: &#***REMOVED***27;present&#***REMOVED***27; })
      .retry(2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.ifError(err);
          assert(res.ok, &#***REMOVED***27;response should be ok&#***REMOVED***27;);
          assert(res.te***REMOVED***t, &#***REMOVED***27;res.te***REMOVED***t&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should handle server timeout error after repeat attempt</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/delay/400&#***REMOVED***60;)
      .timeout(200)
      .retry(2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(2, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should handle successful request after repeat attempt from server timeout</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const url = &#***REMOVED***60;/delay/1200/ok/${uniqid()}?built=in&#***REMOVED***60;;
    request
      .get(base + url)
      .query(&#***REMOVED***27;string=ified&#***REMOVED***27;)
      .query({ json: &#***REMOVED***27;ed&#***REMOVED***27; })
      .timeout(600)
      .retry(2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.ifError(err);
          assert(res.ok, &#***REMOVED***27;response should be ok&#***REMOVED***27;);
          assert.equal(res.te***REMOVED***t, &#***REMOVED***60;ok = ${url}&#***REMOVED***26;string=ified&#***REMOVED***26;json=ed&#***REMOVED***60;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should correctly abort a retry attempt</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    let aborted = false;
    const req = request
      .get(&#***REMOVED***60;${base}/delay/400&#***REMOVED***60;)
      .timeout(200)
      .retry(2);
    req.end((err, res) =&#***REMOVED***3E; {
      try {
        assert(false, &#***REMOVED***27;should not complete the request&#***REMOVED***27;);
      } catch (err2) {
        done(err2);
      }
    });
    req.on(&#***REMOVED***27;abort&#***REMOVED***27;, () =&#***REMOVED***3E; {
      aborted = true;
    });
    setTimeout(() =&#***REMOVED***3E; {
      req.abort();
      setTimeout(() =&#***REMOVED***3E; {
        try {
          assert(aborted, &#***REMOVED***27;should be aborted&#***REMOVED***27;);
          done();
        } catch (err) {
          done(err);
        }
      }, 150);
    }, 150);
  }</code></pre></dd>
        <dt>should correctly retain header fields</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/error/ok/${uniqid()}&#***REMOVED***60;)
      .query({ qs: &#***REMOVED***27;present&#***REMOVED***27; })
      .retry(2)
      .set(&#***REMOVED***27;X-Foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.ifError(err);
          assert(res.body);
          res.body.should.have.property(&#***REMOVED***27;***REMOVED***-foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should not retry on 4***REMOVED******REMOVED*** responses</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/bad-request&#***REMOVED***60;)
      .retry(2)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(0, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with 0 .retries&#***REMOVED***27;);
          assert.equal(400, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 400&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should e***REMOVED***ecute callback on retry if passed</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    let callbackCallCount = 0;
    function retryCallback(request) {
      callbackCallCount++;
    }
    request
      .get(&#***REMOVED***60;${base}/error&#***REMOVED***60;)
      .retry(2, retryCallback)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(2, err.retries, &#***REMOVED***27;e***REMOVED***pected an error with .retries&#***REMOVED***27;);
          assert.equal(500, err.status, &#***REMOVED***27;e***REMOVED***pected an error status of 500&#***REMOVED***27;);
          assert.equal(
            2,
            callbackCallCount,
            &#***REMOVED***27;e***REMOVED***pected the callback to be called on each retry&#***REMOVED***27;
          );
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>.timeout(ms)</h1>
      <dl>
        <section class="suite">
          <h1>when timeout is e***REMOVED***ceeded</h1>
          <dl>
            <dt>should error</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/500&#***REMOVED***60;)
        .timeout(150)
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should handle gzip timeout</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/zip&#***REMOVED***60;)
        .timeout(150)
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should handle buffer timeout</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/json&#***REMOVED***60;)
        .buffer(true)
        .timeout(150)
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should error on deadline</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/500&#***REMOVED***60;)
        .timeout({ deadline: 150 })
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should support setting individual options</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/500&#***REMOVED***60;)
        .timeout({ deadline: 10 })
        .timeout({ response: 99999 })
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          assert.equal(&#***REMOVED***27;ETIME&#***REMOVED***27;, err.errno);
          done();
        });
    }</code></pre></dd>
            <dt>should error on response</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/500&#***REMOVED***60;)
        .timeout({ response: 150 })
        .end((err, res) =&#***REMOVED***3E; {
          assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
          assert.equal(
            &#***REMOVED***27;number&#***REMOVED***27;,
            typeof err.timeout,
            &#***REMOVED***27;e***REMOVED***pected an error with .timeout&#***REMOVED***27;
          );
          assert.equal(&#***REMOVED***27;ECONNABORTED&#***REMOVED***27;, err.code, &#***REMOVED***27;e***REMOVED***pected abort error code&#***REMOVED***27;);
          assert.equal(&#***REMOVED***27;ETIMEDOUT&#***REMOVED***27;, err.errno);
          done();
        });
    }</code></pre></dd>
            <dt>should accept slow body with fast response</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/delay/slowbody&#***REMOVED***60;)
        .timeout({ response: 1000 })
        .on(&#***REMOVED***27;progress&#***REMOVED***27;, () =&#***REMOVED***3E; {
          // This only makes the test faster without relying on arbitrary timeouts
          request.get(&#***REMOVED***60;${base}/delay/slowbody/finish&#***REMOVED***60;).end();
        })
        .end(done);
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>use</h1>
          <dl>
            <dt>should use plugin success</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const now = &#***REMOVED***60;${Date.now()}&#***REMOVED***60;;
      function uuid(req) {
        req.set(&#***REMOVED***27;X-UUID&#***REMOVED***27;, now);
        return req;
      }
      function prefi***REMOVED***(req) {
        req.url = uri + req.url;
        return req;
      }
      request
        .get(&#***REMOVED***27;/echo&#***REMOVED***27;)
        .use(uuid)
        .use(prefi***REMOVED***)
        .end((err, res) =&#***REMOVED***3E; {
          assert.strictEqual(res.statusCode, 200);
          assert.equal(res.get(&#***REMOVED***27;X-UUID&#***REMOVED***27;), now);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>subclass</h1>
      <dl>
        <dt>should be an instance of Request</dt>
        <dd><pre><code>const req = request.get(&#***REMOVED***27;/&#***REMOVED***27;);
assert(req instanceof request.Request);</code></pre></dd>
        <dt>should use patched subclass</dt>
        <dd><pre><code>assert(OriginalRequest);
let constructorCalled;
let sendCalled;
function NewRequest(...args) {
  constructorCalled = true;
  OriginalRequest.apply(this, args);
}
NewRequest.prototype = Object.create(OriginalRequest.prototype);
NewRequest.prototype.send = function() {
  sendCalled = true;
  return this;
};
request.Request = NewRequest;
const req = request.get(&#***REMOVED***27;/&#***REMOVED***27;).send();
assert(constructorCalled);
assert(sendCalled);
assert(req instanceof NewRequest);
assert(req instanceof OriginalRequest);</code></pre></dd>
        <dt>should use patched subclass in agent too</dt>
        <dd><pre><code>if (!request.agent) return; // Node-only
function NewRequest(...args) {
  OriginalRequest.apply(this, args);
}
NewRequest.prototype = Object.create(OriginalRequest.prototype);
request.Request = NewRequest;
const req = request.agent().del(&#***REMOVED***27;/&#***REMOVED***27;);
assert(req instanceof NewRequest);
assert(req instanceof OriginalRequest);</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>persistent agent</h1>
          <dl>
            <dt>should gain a session on POST</dt>
            <dd><pre><code>agent3.post(&#***REMOVED***60;${base}/signin&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
        should.not.e***REMOVED***ist(res.headers[&#***REMOVED***27;set-cookie&#***REMOVED***27;]);
        res.te***REMOVED***t.should.containEql(&#***REMOVED***27;dashboard&#***REMOVED***27;);
      })</code></pre></dd>
            <dt>should start with empty session (set cookies)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      agent1.get(&#***REMOVED***60;${base}/dashboard&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        should.e***REMOVED***ist(err);
        res.should.have.status(401);
        should.e***REMOVED***ist(res.headers[&#***REMOVED***27;set-cookie&#***REMOVED***27;]);
        done();
      });
    }</code></pre></dd>
            <dt>should gain a session (cookies already set)</dt>
            <dd><pre><code>agent1.post(&#***REMOVED***60;${base}/signin&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
        should.not.e***REMOVED***ist(res.headers[&#***REMOVED***27;set-cookie&#***REMOVED***27;]);
        res.te***REMOVED***t.should.containEql(&#***REMOVED***27;dashboard&#***REMOVED***27;);
      })</code></pre></dd>
            <dt>should persist cookies across requests</dt>
            <dd><pre><code>agent1.get(&#***REMOVED***60;${base}/dashboard&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
      })</code></pre></dd>
            <dt>should have the cookie set in the end callback</dt>
            <dd><pre><code>agent4
        .post(&#***REMOVED***60;${base}/setcookie&#***REMOVED***60;)
        .then(() =&#***REMOVED***3E; agent4.get(&#***REMOVED***60;${base}/getcookie&#***REMOVED***60;))
        .then(res =&#***REMOVED***3E; {
          res.should.have.status(200);
          assert.strictEqual(res.te***REMOVED***t, &#***REMOVED***27;jar&#***REMOVED***27;);
        })</code></pre></dd>
            <dt>should not share cookies</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      agent2.get(&#***REMOVED***60;${base}/dashboard&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        should.e***REMOVED***ist(err);
        res.should.have.status(401);
        done();
      });
    }</code></pre></dd>
            <dt>should not lose cookies between agents</dt>
            <dd><pre><code>agent1.get(&#***REMOVED***60;${base}/dashboard&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
      })</code></pre></dd>
            <dt>should be able to follow redirects</dt>
            <dd><pre><code>agent1.get(base).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
        res.te***REMOVED***t.should.containEql(&#***REMOVED***27;dashboard&#***REMOVED***27;);
      })</code></pre></dd>
            <dt>should be able to post redirects</dt>
            <dd><pre><code>agent1
        .post(&#***REMOVED***60;${base}/redirect&#***REMOVED***60;)
        .send({ foo: &#***REMOVED***27;bar&#***REMOVED***27;, baz: &#***REMOVED***27;blaaah&#***REMOVED***27; })
        .then(res =&#***REMOVED***3E; {
          res.should.have.status(200);
          res.te***REMOVED***t.should.containEql(&#***REMOVED***27;simple&#***REMOVED***27;);
          res.redirects.should.eql([&#***REMOVED***60;${base}/simple&#***REMOVED***60;]);
        })</code></pre></dd>
            <dt>should be able to limit redirects</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      agent1
        .get(base)
        .redirects(0)
        .end((err, res) =&#***REMOVED***3E; {
          should.e***REMOVED***ist(err);
          res.should.have.status(302);
          res.redirects.should.eql([]);
          res.header.location.should.equal(&#***REMOVED***27;/dashboard&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
            <dt>should be able to create a new session (clear cookie)</dt>
            <dd><pre><code>agent1.post(&#***REMOVED***60;${base}/signout&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.should.have.status(200);
        should.e***REMOVED***ist(res.headers[&#***REMOVED***27;set-cookie&#***REMOVED***27;]);
      })</code></pre></dd>
            <dt>should regenerate with an empty session</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      agent1.get(&#***REMOVED***60;${base}/dashboard&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        should.e***REMOVED***ist(err);
        res.should.have.status(401);
        should.not.e***REMOVED***ist(res.headers[&#***REMOVED***27;set-cookie&#***REMOVED***27;]);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>Basic auth</h1>
      <dl>
        <section class="suite">
          <h1>when credentials are present in url</h1>
          <dl>
            <dt>should set Authorization</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const new_url = URL.parse(base);
      new_url.auth = &#***REMOVED***27;tobi:learnboost&#***REMOVED***27;;
      new_url.pathname = &#***REMOVED***27;/basic-auth&#***REMOVED***27;;
      request.get(URL.format(new_url)).end((err, res) =&#***REMOVED***3E; {
        res.status.should.equal(200);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.auth(user, pass)</h1>
          <dl>
            <dt>should set Authorization</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/basic-auth&#***REMOVED***60;)
        .auth(&#***REMOVED***27;tobi&#***REMOVED***27;, &#***REMOVED***27;learnboost&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          res.status.should.equal(200);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.auth(user + &#***REMOVED***22;:&#***REMOVED***22; + pass)</h1>
          <dl>
            <dt>should set authorization</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/basic-auth/again&#***REMOVED***60;)
        .auth(&#***REMOVED***27;tobi&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          res.status.should.eql(200);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>[node] request</h1>
      <dl>
        <dt>should send body with .get().send()</dt>
        <dd><pre><code>ne***REMOVED***t =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;)
        .send(&#***REMOVED***27;wahoo&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.equal(&#***REMOVED***27;wahoo&#***REMOVED***27;, res.te***REMOVED***t);
            ne***REMOVED***t();
          } catch (err2) {
            ne***REMOVED***t(err2);
          }
        });
    }</code></pre></dd>
        <section class="suite">
          <h1>with an url</h1>
          <dl>
            <dt>should preserve the encoding of the url</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/url?a=(b%29&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert.equal(&#***REMOVED***27;/url?a=(b%29&#***REMOVED***27;, res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with an object</h1>
          <dl>
            <dt>should format the url</dt>
            <dd><pre><code>request.get(url.parse(&#***REMOVED***60;${base}/login&#***REMOVED***60;)).then(res =&#***REMOVED***3E; {
        assert(res.ok);
      })</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>without a schema</h1>
          <dl>
            <dt>should default to http</dt>
            <dd><pre><code>request.get(&#***REMOVED***27;localhost:5000/login&#***REMOVED***27;).then(res =&#***REMOVED***3E; {
        assert.equal(res.status, 200);
      })</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.toJSON()</h1>
          <dl>
            <dt>should describe the response</dt>
            <dd><pre><code>request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .send({ foo: &#***REMOVED***27;baz&#***REMOVED***27; })
        .then(res =&#***REMOVED***3E; {
          const obj = res.toJSON();
          assert.equal(&#***REMOVED***27;object&#***REMOVED***27;, typeof obj.header);
          assert.equal(&#***REMOVED***27;object&#***REMOVED***27;, typeof obj.req);
          assert.equal(200, obj.status);
          assert.equal(&#***REMOVED***27;{&#***REMOVED***22;foo&#***REMOVED***22;:&#***REMOVED***22;baz&#***REMOVED***22;}&#***REMOVED***27;, obj.te***REMOVED***t);
        })</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>res.links</h1>
          <dl>
            <dt>should default to an empty object</dt>
            <dd><pre><code>request.get(&#***REMOVED***60;${base}/login&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
        res.links.should.eql({});
      })</code></pre></dd>
            <dt>should parse the Link header field</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/links&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.links.ne***REMOVED***t.should.equal(
          &#***REMOVED***27;https://api.github.com/repos/visionmedia/mocha/issues?page=2&#***REMOVED***27;
        );
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.unset(field)</h1>
          <dl>
            <dt>should remove the header field</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .unset(&#***REMOVED***27;User-Agent&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          assert.equal(void 0, res.header[&#***REMOVED***27;user-agent&#***REMOVED***27;]);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>case-insensitive</h1>
          <dl>
            <dt>should set/get header fields case-insensitively</dt>
            <dd><pre><code>const r = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
r.set(&#***REMOVED***27;MiXeD&#***REMOVED***27;, &#***REMOVED***27;helloes&#***REMOVED***27;);
assert.strictEqual(r.get(&#***REMOVED***27;mi***REMOVED***ed&#***REMOVED***27;), &#***REMOVED***27;helloes&#***REMOVED***27;);</code></pre></dd>
            <dt>should unset header fields case-insensitively</dt>
            <dd><pre><code>const r = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
r.set(&#***REMOVED***27;MiXeD&#***REMOVED***27;, &#***REMOVED***27;helloes&#***REMOVED***27;);
r.unset(&#***REMOVED***27;MIXED&#***REMOVED***27;);
assert.strictEqual(r.get(&#***REMOVED***27;mi***REMOVED***ed&#***REMOVED***27;), undefined);</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.write(str)</h1>
          <dl>
            <dt>should write the given data</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
      req.set(&#***REMOVED***27;Content-Type&#***REMOVED***27;, &#***REMOVED***27;application/json&#***REMOVED***27;);
      assert.equal(&#***REMOVED***27;boolean&#***REMOVED***27;, typeof req.write(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;&#***REMOVED***27;));
      assert.equal(&#***REMOVED***27;boolean&#***REMOVED***27;, typeof req.write(&#***REMOVED***27;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;));
      req.end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>req.pipe(stream)</h1>
          <dl>
            <dt>should pipe the response to the given stream</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const stream = new EventEmitter();
      stream.buf = &#***REMOVED***27;&#***REMOVED***27;;
      stream.writable = true;
      stream.write = function(chunk) {
        this.buf += chunk;
      };
      stream.end = function() {
        this.buf.should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
        done();
      };
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .send(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;)
        .pipe(stream);
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.buffer()</h1>
          <dl>
            <dt>should enable buffering</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/custom&#***REMOVED***60;)
        .buffer()
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert.equal(&#***REMOVED***27;custom stuff&#***REMOVED***27;, res.te***REMOVED***t);
          assert(res.buffered);
          done();
        });
    }</code></pre></dd>
            <dt>should take precedence over request.buffer[&#***REMOVED***27;someMimeType&#***REMOVED***27;] = false</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const type = &#***REMOVED***27;application/barbaz&#***REMOVED***27;;
      const send = &#***REMOVED***27;some te***REMOVED***t&#***REMOVED***27;;
      request.buffer[type] = false;
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(type)
        .send(send)
        .buffer()
        .end((err, res) =&#***REMOVED***3E; {
          delete request.buffer[type];
          assert.ifError(err);
          assert.equal(res.type, type);
          assert.equal(send, res.te***REMOVED***t);
          assert(res.buffered);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.buffer(false)</h1>
          <dl>
            <dt>should disable buffering</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;application/***REMOVED***-dog&#***REMOVED***27;)
        .send(&#***REMOVED***27;hello this is dog&#***REMOVED***27;)
        .buffer(false)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert.equal(null, res.te***REMOVED***t);
          res.body.should.eql({});
          let buf = &#***REMOVED***27;&#***REMOVED***27;;
          res.setEncoding(&#***REMOVED***27;utf8&#***REMOVED***27;);
          res.on(&#***REMOVED***27;data&#***REMOVED***27;, chunk =&#***REMOVED***3E; {
            buf += chunk;
          });
          res.on(&#***REMOVED***27;end&#***REMOVED***27;, () =&#***REMOVED***3E; {
            buf.should.equal(&#***REMOVED***27;hello this is dog&#***REMOVED***27;);
            done();
          });
        });
    }</code></pre></dd>
            <dt>should take precedence over request.buffer[&#***REMOVED***27;someMimeType&#***REMOVED***27;] = true</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const type = &#***REMOVED***27;application/foobar&#***REMOVED***27;;
      const send = &#***REMOVED***27;hello this is a dog&#***REMOVED***27;;
      request.buffer[type] = true;
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(type)
        .send(send)
        .buffer(false)
        .end((err, res) =&#***REMOVED***3E; {
          delete request.buffer[type];
          assert.ifError(err);
          assert.equal(null, res.te***REMOVED***t);
          assert.equal(res.type, type);
          assert(!res.buffered);
          res.body.should.eql({});
          let buf = &#***REMOVED***27;&#***REMOVED***27;;
          res.setEncoding(&#***REMOVED***27;utf8&#***REMOVED***27;);
          res.on(&#***REMOVED***27;data&#***REMOVED***27;, chunk =&#***REMOVED***3E; {
            buf += chunk;
          });
          res.on(&#***REMOVED***27;end&#***REMOVED***27;, () =&#***REMOVED***3E; {
            buf.should.equal(send);
            done();
          });
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.withCredentials()</h1>
          <dl>
            <dt>should not throw an error when using the client-side &#***REMOVED***22;withCredentials&#***REMOVED***22; method</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/custom&#***REMOVED***60;)
        .withCredentials()
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.agent()</h1>
          <dl>
            <dt>should return the defaut agent</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
      req.agent().should.equal(false);
      done();
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.agent(undefined)</h1>
          <dl>
            <dt>should set an agent to undefined and ensure it is chainable</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
      const ret = req.agent(undefined);
      ret.should.equal(req);
      assert.strictEqual(req.agent(), undefined);
      done();
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>.agent(new http.Agent())</h1>
          <dl>
            <dt>should set passed agent</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const http = require(&#***REMOVED***27;http&#***REMOVED***27;);
      const req = request.get(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
      const agent = new http.Agent();
      const ret = req.agent(agent);
      ret.should.equal(req);
      req.agent().should.equal(agent);
      done();
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with a content type other than application/json or te***REMOVED***t/*</h1>
          <dl>
            <dt>should still use buffering</dt>
            <dd><pre><code>return request
  .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
  .type(&#***REMOVED***27;application/***REMOVED***-dog&#***REMOVED***27;)
  .send(&#***REMOVED***27;hello this is dog&#***REMOVED***27;)
  .then(res =&#***REMOVED***3E; {
    assert.equal(null, res.te***REMOVED***t);
    assert.equal(res.body.toString(), &#***REMOVED***27;hello this is dog&#***REMOVED***27;);
    res.buffered.should.be.true;
  });</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>content-length</h1>
          <dl>
            <dt>should be set to the byte length of a non-buffer object</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const decoder = new StringDecoder(&#***REMOVED***27;utf8&#***REMOVED***27;);
      let img = fs.readFileSync(&#***REMOVED***60;${__dirname}/fi***REMOVED***tures/test.png&#***REMOVED***60;);
      img = decoder.write(img);
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;application/***REMOVED***-image&#***REMOVED***27;)
        .send(img)
        .buffer(false)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert(!res.buffered);
          assert.equal(res.header[&#***REMOVED***27;content-length&#***REMOVED***27;], Buffer.byteLength(img));
          done();
        });
    }</code></pre></dd>
            <dt>should be set to the length of a buffer object</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const img = fs.readFileSync(&#***REMOVED***60;${__dirname}/fi***REMOVED***tures/test.png&#***REMOVED***60;);
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .type(&#***REMOVED***27;application/***REMOVED***-image&#***REMOVED***27;)
        .send(img)
        .buffer(true)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert(res.buffered);
          assert.equal(res.header[&#***REMOVED***27;content-length&#***REMOVED***27;], img.length);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>req.buffer[&#***REMOVED***27;someMimeType&#***REMOVED***27;]</h1>
      <dl>
        <dt>should respect that agent.buffer(true) takes precedent</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const agent = request.agent();
    agent.buffer(true);
    const type = &#***REMOVED***27;application/somerandomtype&#***REMOVED***27;;
    const send = &#***REMOVED***27;somerandomte***REMOVED***t&#***REMOVED***27;;
    request.buffer[type] = false;
    agent
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .type(type)
      .send(send)
      .end((err, res) =&#***REMOVED***3E; {
        delete request.buffer[type];
        assert.ifError(err);
        assert.equal(res.type, type);
        assert.equal(send, res.te***REMOVED***t);
        assert(res.buffered);
        done();
      });
  }</code></pre></dd>
        <dt>should respect that agent.buffer(false) takes precedent</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const agent = request.agent();
    agent.buffer(false);
    const type = &#***REMOVED***27;application/barrr&#***REMOVED***27;;
    const send = &#***REMOVED***27;some random te***REMOVED***t2&#***REMOVED***27;;
    request.buffer[type] = true;
    agent
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .type(type)
      .send(send)
      .end((err, res) =&#***REMOVED***3E; {
        delete request.buffer[type];
        assert.ifError(err);
        assert.equal(null, res.te***REMOVED***t);
        assert.equal(res.type, type);
        assert(!res.buffered);
        res.body.should.eql({});
        let buf = &#***REMOVED***27;&#***REMOVED***27;;
        res.setEncoding(&#***REMOVED***27;utf8&#***REMOVED***27;);
        res.on(&#***REMOVED***27;data&#***REMOVED***27;, chunk =&#***REMOVED***3E; {
          buf += chunk;
        });
        res.on(&#***REMOVED***27;end&#***REMOVED***27;, () =&#***REMOVED***3E; {
          buf.should.equal(send);
          done();
        });
      });
  }</code></pre></dd>
        <dt>should disable buffering for that mimetype when false</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const type = &#***REMOVED***27;application/bar&#***REMOVED***27;;
    const send = &#***REMOVED***27;some random te***REMOVED***t&#***REMOVED***27;;
    request.buffer[type] = false;
    request
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .type(type)
      .send(send)
      .end((err, res) =&#***REMOVED***3E; {
        delete request.buffer[type];
        assert.ifError(err);
        assert.equal(null, res.te***REMOVED***t);
        assert.equal(res.type, type);
        assert(!res.buffered);
        res.body.should.eql({});
        let buf = &#***REMOVED***27;&#***REMOVED***27;;
        res.setEncoding(&#***REMOVED***27;utf8&#***REMOVED***27;);
        res.on(&#***REMOVED***27;data&#***REMOVED***27;, chunk =&#***REMOVED***3E; {
          buf += chunk;
        });
        res.on(&#***REMOVED***27;end&#***REMOVED***27;, () =&#***REMOVED***3E; {
          buf.should.equal(send);
          done();
        });
      });
  }</code></pre></dd>
        <dt>should enable buffering for that mimetype when true</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const type = &#***REMOVED***27;application/baz&#***REMOVED***27;;
    const send = &#***REMOVED***27;woooo&#***REMOVED***27;;
    request.buffer[type] = true;
    request
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .type(type)
      .send(send)
      .end((err, res) =&#***REMOVED***3E; {
        delete request.buffer[type];
        assert.ifError(err);
        assert.equal(res.type, type);
        assert.equal(send, res.te***REMOVED***t);
        assert(res.buffered);
        done();
      });
  }</code></pre></dd>
        <dt>should fallback to default handling for that mimetype when undefined</dt>
        <dd><pre><code>const type = &#***REMOVED***27;application/bazzz&#***REMOVED***27;;
const send = &#***REMOVED***27;woooooo&#***REMOVED***27;;
return request
  .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
  .type(type)
  .send(send)
  .then(res =&#***REMOVED***3E; {
    assert.equal(res.type, type);
    assert.equal(send, res.body.toString());
    assert(res.buffered);
  });</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>e***REMOVED***ports</h1>
      <dl>
        <dt>should e***REMOVED***pose .protocols</dt>
        <dd><pre><code>Object.keys(request.protocols).should.eql([&#***REMOVED***27;http:&#***REMOVED***27;, &#***REMOVED***27;https:&#***REMOVED***27;, &#***REMOVED***27;http2:&#***REMOVED***27;]);</code></pre></dd>
        <dt>should e***REMOVED***pose .serialize</dt>
        <dd><pre><code>Object.keys(request.serialize).should.eql([
  &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;,
  &#***REMOVED***27;application/json&#***REMOVED***27;
]);</code></pre></dd>
        <dt>should e***REMOVED***pose .parse</dt>
        <dd><pre><code>Object.keys(request.parse).should.eql([
  &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;,
  &#***REMOVED***27;application/json&#***REMOVED***27;,
  &#***REMOVED***27;te***REMOVED***t&#***REMOVED***27;,
  &#***REMOVED***27;application/octet-stream&#***REMOVED***27;,
  &#***REMOVED***27;application/pdf&#***REMOVED***27;,
  &#***REMOVED***27;image&#***REMOVED***27;
]);</code></pre></dd>
        <dt>should e***REMOVED***port .buffer</dt>
        <dd><pre><code>Object.keys(request.buffer).should.eql([]);</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>flags</h1>
      <dl>
        <section class="suite">
          <h1>with 4***REMOVED******REMOVED*** response</h1>
          <dl>
            <dt>should set res.error and res.clientError</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(!res.ok, &#***REMOVED***27;response should not be ok&#***REMOVED***27;);
        assert(res.error, &#***REMOVED***27;response should be an error&#***REMOVED***27;);
        assert(res.clientError, &#***REMOVED***27;response should be a client error&#***REMOVED***27;);
        assert(!res.serverError, &#***REMOVED***27;response should not be a server error&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 5***REMOVED******REMOVED*** response</h1>
          <dl>
            <dt>should set res.error and res.serverError</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/error&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(!res.ok, &#***REMOVED***27;response should not be ok&#***REMOVED***27;);
        assert(!res.notFound, &#***REMOVED***27;response should not be notFound&#***REMOVED***27;);
        assert(res.error, &#***REMOVED***27;response should be an error&#***REMOVED***27;);
        assert(!res.clientError, &#***REMOVED***27;response should not be a client error&#***REMOVED***27;);
        assert(res.serverError, &#***REMOVED***27;response should be a server error&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 404 Not Found</h1>
          <dl>
            <dt>should res.notFound</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/notfound&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(res.notFound, &#***REMOVED***27;response should be .notFound&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 400 Bad Request</h1>
          <dl>
            <dt>should set req.badRequest</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/bad-request&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(res.badRequest, &#***REMOVED***27;response should be .badRequest&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 401 Bad Request</h1>
          <dl>
            <dt>should set res.unauthorized</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/unauthorized&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(res.unauthorized, &#***REMOVED***27;response should be .unauthorized&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 406 Not Acceptable</h1>
          <dl>
            <dt>should set res.notAcceptable</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/not-acceptable&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(res.notAcceptable, &#***REMOVED***27;response should be .notAcceptable&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 204 No Content</h1>
          <dl>
            <dt>should set res.noContent</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/no-content&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(!err);
        assert(res.noContent, &#***REMOVED***27;response should be .noContent&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 201 Created</h1>
          <dl>
            <dt>should set res.created</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.post(&#***REMOVED***60;${base}/created&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(!err);
        assert(res.created, &#***REMOVED***27;response should be .created&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>with 422 Unprocessable Entity</h1>
          <dl>
            <dt>should set res.unprocessableEntity</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.post(&#***REMOVED***60;${base}/unprocessable-entity&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(err);
        assert(
          res.unprocessableEntity,
          &#***REMOVED***27;response should be .unprocessableEntity&#***REMOVED***27;
        );
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>Merging objects</h1>
      <dl>
        <dt>Don&#***REMOVED***27;t mi***REMOVED*** Buffer and JSON</dt>
        <dd><pre><code>assert.throws(() =&#***REMOVED***3E; {
  request
    .post(&#***REMOVED***27;/echo&#***REMOVED***27;)
    .send(Buffer.from(&#***REMOVED***27;some buffer&#***REMOVED***27;))
    .send({ allowed: false });
});</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.send(String)</h1>
      <dl>
        <dt>should default to &#***REMOVED***22;form&#***REMOVED***22;</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .send(&#***REMOVED***27;user[name]=tj&#***REMOVED***27;)
      .send(&#***REMOVED***27;user[email]=tj@vision-media.ca&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.header[&#***REMOVED***27;content-type&#***REMOVED***27;].should.equal(
          &#***REMOVED***27;application/***REMOVED***-www-form-urlencoded&#***REMOVED***27;
        );
        res.body.should.eql({
          user: { name: &#***REMOVED***27;tj&#***REMOVED***27;, email: &#***REMOVED***27;tj@vision-media.ca&#***REMOVED***27; }
        });
        done();
      });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>res.body</h1>
      <dl>
        <section class="suite">
          <h1>application/***REMOVED***-www-form-urlencoded</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/form-data&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;pet[name]=manny&#***REMOVED***27;);
        res.body.should.eql({ pet: { name: &#***REMOVED***27;manny&#***REMOVED***27; } });
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>https</h1>
      <dl>
        <section class="suite">
          <h1>certificate authority</h1>
          <dl>
            <section class="suite">
              <h1>request</h1>
              <dl>
                <dt>should give a good response</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        request
          .get(testEndpoint)
          .ca(ca)
          .end((err, res) =&#***REMOVED***3E; {
            assert.ifError(err);
            assert(res.ok);
            assert.strictEqual(&#***REMOVED***27;Safe and secure!&#***REMOVED***27;, res.te***REMOVED***t);
            done();
          });
      }</code></pre></dd>
                <dt>should reject unauthorized response</dt>
                <dd><pre><code>return request
  .get(testEndpoint)
  .trustLocalhost(false)
  .then(
    () =&#***REMOVED***3E; {
      throw new Error(&#***REMOVED***27;Allows MITM&#***REMOVED***27;);
    },
    () =&#***REMOVED***3E; {}
  );</code></pre></dd>
                <dt>should trust localhost unauthorized response</dt>
                <dd><pre><code>return request.get(testEndpoint).trustLocalhost(true);</code></pre></dd>
                <dt>should trust overriden localhost unauthorized response</dt>
                <dd><pre><code>return request
  .get(&#***REMOVED***60;https://e***REMOVED***ample.com:${server.address().port}&#***REMOVED***60;)
  .connect(&#***REMOVED***27;127.0.0.1&#***REMOVED***27;)
  .trustLocalhost();</code></pre></dd>
              </dl>
            </section>
            <section class="suite">
              <h1>.agent</h1>
              <dl>
                <dt>should be able to make multiple requests without redefining the certificate</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        const agent = request.agent({ ca });
        agent.get(testEndpoint).end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert(res.ok);
          assert.strictEqual(&#***REMOVED***27;Safe and secure!&#***REMOVED***27;, res.te***REMOVED***t);
          agent.get(url.parse(testEndpoint)).end((err, res) =&#***REMOVED***3E; {
            assert.ifError(err);
            assert(res.ok);
            assert.strictEqual(&#***REMOVED***27;Safe and secure!&#***REMOVED***27;, res.te***REMOVED***t);
            done();
          });
        });
      }</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
        <section class="suite">
          <h1>client certificates</h1>
          <dl>
            <section class="suite">
              <h1>request</h1>
              <dl>
              </dl>
            </section>
            <section class="suite">
              <h1>.agent</h1>
              <dl>
              </dl>
            </section>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>res.body</h1>
      <dl>
        <section class="suite">
          <h1>image/png</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/image&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.type.should.equal(&#***REMOVED***27;image/png&#***REMOVED***27;);
        Buffer.isBuffer(res.body).should.be.true();
        (res.body.length - img.length).should.equal(0);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>application/octet-stream</h1>
          <dl>
            <dt>should parse the body</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/image-as-octets&#***REMOVED***60;)
        .buffer(true) // that&#***REMOVED***27;s tech debt :(
        .end((err, res) =&#***REMOVED***3E; {
          res.type.should.equal(&#***REMOVED***27;application/octet-stream&#***REMOVED***27;);
          Buffer.isBuffer(res.body).should.be.true();
          (res.body.length - img.length).should.equal(0);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>application/octet-stream</h1>
          <dl>
            <dt>should parse the body (using responseType)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/image-as-octets&#***REMOVED***60;)
        .responseType(&#***REMOVED***27;blob&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          res.type.should.equal(&#***REMOVED***27;application/octet-stream&#***REMOVED***27;);
          Buffer.isBuffer(res.body).should.be.true();
          (res.body.length - img.length).should.equal(0);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>zlib</h1>
      <dl>
        <dt>should deflate the content</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(base).end((err, res) =&#***REMOVED***3E; {
      res.should.have.status(200);
      res.te***REMOVED***t.should.equal(subject);
      res.headers[&#***REMOVED***27;content-length&#***REMOVED***27;].should.be.below(subject.length);
      done();
    });
  }</code></pre></dd>
        <dt>should protect from zip bombs</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(base)
      .buffer(true)
      .ma***REMOVED***ResponseSize(1)
      .end((err, res) =&#***REMOVED***3E; {
        try {
          assert.equal(&#***REMOVED***27;Ma***REMOVED***imum response size reached&#***REMOVED***27;, err &#***REMOVED***26;&#***REMOVED***26; err.message);
          done();
        } catch (err2) {
          done(err2);
        }
      });
  }</code></pre></dd>
        <dt>should ignore trailing junk</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${base}/junk&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      res.should.have.status(200);
      res.te***REMOVED***t.should.equal(subject);
      done();
    });
  }</code></pre></dd>
        <dt>should ignore missing data</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${base}/chopped&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      assert.equal(undefined, err);
      res.should.have.status(200);
      res.te***REMOVED***t.should.startWith(subject);
      done();
    });
  }</code></pre></dd>
        <dt>should handle corrupted responses</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${base}/corrupt&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      assert(err, &#***REMOVED***27;missing error&#***REMOVED***27;);
      assert(!res, &#***REMOVED***27;response should not be defined&#***REMOVED***27;);
      done();
    });
  }</code></pre></dd>
        <dt>should handle no content with gzip header</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(&#***REMOVED***60;${base}/nocontent&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      assert.ifError(err);
      assert(res);
      res.should.have.status(204);
      res.te***REMOVED***t.should.equal(&#***REMOVED***27;&#***REMOVED***27;);
      res.headers.should.not.have.property(&#***REMOVED***27;content-length&#***REMOVED***27;);
      done();
    });
  }</code></pre></dd>
        <section class="suite">
          <h1>without encoding set</h1>
          <dl>
            <dt>should buffer if asked</dt>
            <dd><pre><code>return request
  .get(&#***REMOVED***60;${base}/binary&#***REMOVED***60;)
  .buffer(true)
  .then(res =&#***REMOVED***3E; {
    res.should.have.status(200);
    assert(res.headers[&#***REMOVED***27;content-length&#***REMOVED***27;]);
    assert(res.body.byteLength);
    assert.equal(subject, res.body.toString());
  });</code></pre></dd>
            <dt>should emit buffers</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/binary&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.should.have.status(200);
        res.headers[&#***REMOVED***27;content-length&#***REMOVED***27;].should.be.below(subject.length);
        res.on(&#***REMOVED***27;data&#***REMOVED***27;, chunk =&#***REMOVED***3E; {
          chunk.should.have.length(subject.length);
        });
        res.on(&#***REMOVED***27;end&#***REMOVED***27;, done);
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>Multipart</h1>
      <dl>
        <section class="suite">
          <h1>#field(name, value)</h1>
          <dl>
            <dt>should set a multipart field value</dt>
            <dd><pre><code>const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
req.field(&#***REMOVED***27;user[name]&#***REMOVED***27;, &#***REMOVED***27;tobi&#***REMOVED***27;);
req.field(&#***REMOVED***27;user[age]&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;);
req.field(&#***REMOVED***27;user[species]&#***REMOVED***27;, &#***REMOVED***27;ferret&#***REMOVED***27;);
return req.then(res =&#***REMOVED***3E; {
  res.body[&#***REMOVED***27;user[name]&#***REMOVED***27;].should.equal(&#***REMOVED***27;tobi&#***REMOVED***27;);
  res.body[&#***REMOVED***27;user[age]&#***REMOVED***27;].should.equal(&#***REMOVED***27;2&#***REMOVED***27;);
  res.body[&#***REMOVED***27;user[species]&#***REMOVED***27;].should.equal(&#***REMOVED***27;ferret&#***REMOVED***27;);
});</code></pre></dd>
            <dt>should work with file attachments</dt>
            <dd><pre><code>const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
req.field(&#***REMOVED***27;name&#***REMOVED***27;, &#***REMOVED***27;Tobi&#***REMOVED***27;);
req.attach(&#***REMOVED***27;document&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.html&#***REMOVED***27;);
req.field(&#***REMOVED***27;species&#***REMOVED***27;, &#***REMOVED***27;ferret&#***REMOVED***27;);
return req.then(res =&#***REMOVED***3E; {
  res.body.name.should.equal(&#***REMOVED***27;Tobi&#***REMOVED***27;);
  res.body.species.should.equal(&#***REMOVED***27;ferret&#***REMOVED***27;);
  const html = res.files.document;
  html.name.should.equal(&#***REMOVED***27;user.html&#***REMOVED***27;);
  html.type.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
  read(html.path).should.equal(&#***REMOVED***27;&#***REMOVED***3C;h1&#***REMOVED***3E;name&#***REMOVED***3C;/h1&#***REMOVED***3E;&#***REMOVED***27;);
});</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>#attach(name, path)</h1>
          <dl>
            <dt>should attach a file</dt>
            <dd><pre><code>const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
req.attach(&#***REMOVED***27;one&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.html&#***REMOVED***27;);
req.attach(&#***REMOVED***27;two&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.json&#***REMOVED***27;);
req.attach(&#***REMOVED***27;three&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.t***REMOVED***t&#***REMOVED***27;);
return req.then(res =&#***REMOVED***3E; {
  const html = res.files.one;
  const json = res.files.two;
  const te***REMOVED***t = res.files.three;
  html.name.should.equal(&#***REMOVED***27;user.html&#***REMOVED***27;);
  html.type.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
  read(html.path).should.equal(&#***REMOVED***27;&#***REMOVED***3C;h1&#***REMOVED***3E;name&#***REMOVED***3C;/h1&#***REMOVED***3E;&#***REMOVED***27;);
  json.name.should.equal(&#***REMOVED***27;user.json&#***REMOVED***27;);
  json.type.should.equal(&#***REMOVED***27;application/json&#***REMOVED***27;);
  read(json.path).should.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;tobi&#***REMOVED***22;}&#***REMOVED***27;);
  te***REMOVED***t.name.should.equal(&#***REMOVED***27;user.t***REMOVED***t&#***REMOVED***27;);
  te***REMOVED***t.type.should.equal(&#***REMOVED***27;te***REMOVED***t/plain&#***REMOVED***27;);
  read(te***REMOVED***t.path).should.equal(&#***REMOVED***27;Tobi&#***REMOVED***27;);
});</code></pre></dd>
            <section class="suite">
              <h1>when a file does not e***REMOVED***ist</h1>
              <dl>
                <dt>should fail the request with an error</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        const req = request.post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;);
        req.attach(&#***REMOVED***27;name&#***REMOVED***27;, &#***REMOVED***27;foo&#***REMOVED***27;);
        req.attach(&#***REMOVED***27;name2&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;);
        req.attach(&#***REMOVED***27;name3&#***REMOVED***27;, &#***REMOVED***27;baz&#***REMOVED***27;);
        req.end((err, res) =&#***REMOVED***3E; {
          assert.ok(Boolean(err), &#***REMOVED***27;Request should have failed.&#***REMOVED***27;);
          err.code.should.equal(&#***REMOVED***27;ENOENT&#***REMOVED***27;);
          err.message.should.containEql(&#***REMOVED***27;ENOENT&#***REMOVED***27;);
          err.path.should.equal(&#***REMOVED***27;foo&#***REMOVED***27;);
          done();
        });
      }</code></pre></dd>
                <dt>promise should fail</dt>
                <dd><pre><code>return request
  .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
  .field({ a: 1, b: 2 })
  .attach(&#***REMOVED***27;c&#***REMOVED***27;, &#***REMOVED***27;does-not-e***REMOVED***ist.t***REMOVED***t&#***REMOVED***27;)
  .then(
    res =&#***REMOVED***3E; assert.fail(&#***REMOVED***27;It should not allow this&#***REMOVED***27;),
    err =&#***REMOVED***3E; {
      err.code.should.equal(&#***REMOVED***27;ENOENT&#***REMOVED***27;);
      err.path.should.equal(&#***REMOVED***27;does-not-e***REMOVED***ist.t***REMOVED***t&#***REMOVED***27;);
    }
  );</code></pre></dd>
                <dt>should report ECONNREFUSED via the callback</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        request
          .post(&#***REMOVED***27;http://127.0.0.1:1&#***REMOVED***27;) // nobody is listening there
          .attach(&#***REMOVED***27;name&#***REMOVED***27;, &#***REMOVED***27;file-does-not-e***REMOVED***ist&#***REMOVED***27;)
          .end((err, res) =&#***REMOVED***3E; {
            assert.ok(Boolean(err), &#***REMOVED***27;Request should have failed&#***REMOVED***27;);
            err.code.should.equal(&#***REMOVED***27;ECONNREFUSED&#***REMOVED***27;);
            done();
          });
      }</code></pre></dd>
                <dt>should report ECONNREFUSED via Promise</dt>
                <dd><pre><code>return request
  .post(&#***REMOVED***27;http://127.0.0.1:1&#***REMOVED***27;) // nobody is listening there
  .attach(&#***REMOVED***27;name&#***REMOVED***27;, &#***REMOVED***27;file-does-not-e***REMOVED***ist&#***REMOVED***27;)
  .then(
    res =&#***REMOVED***3E; assert.fail(&#***REMOVED***27;Request should have failed&#***REMOVED***27;),
    err =&#***REMOVED***3E; err.code.should.equal(&#***REMOVED***27;ECONNREFUSED&#***REMOVED***27;)
  );</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
        <section class="suite">
          <h1>#attach(name, path, filename)</h1>
          <dl>
            <dt>should use the custom filename</dt>
            <dd><pre><code>request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .attach(&#***REMOVED***27;document&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.html&#***REMOVED***27;, &#***REMOVED***27;doc.html&#***REMOVED***27;)
        .then(res =&#***REMOVED***3E; {
          const html = res.files.document;
          html.name.should.equal(&#***REMOVED***27;doc.html&#***REMOVED***27;);
          html.type.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
          read(html.path).should.equal(&#***REMOVED***27;&#***REMOVED***3C;h1&#***REMOVED***3E;name&#***REMOVED***3C;/h1&#***REMOVED***3E;&#***REMOVED***27;);
        })</code></pre></dd>
            <dt>should fire progress event</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      let loaded = 0;
      let total = 0;
      let uploadEventWasFired = false;
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .attach(&#***REMOVED***27;document&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/user.html&#***REMOVED***27;)
        .on(&#***REMOVED***27;progress&#***REMOVED***27;, event =&#***REMOVED***3E; {
          total = event.total;
          loaded = event.loaded;
          if (event.direction === &#***REMOVED***27;upload&#***REMOVED***27;) {
            uploadEventWasFired = true;
          }
        })
        .end((err, res) =&#***REMOVED***3E; {
          if (err) return done(err);
          const html = res.files.document;
          html.name.should.equal(&#***REMOVED***27;user.html&#***REMOVED***27;);
          html.type.should.equal(&#***REMOVED***27;te***REMOVED***t/html&#***REMOVED***27;);
          read(html.path).should.equal(&#***REMOVED***27;&#***REMOVED***3C;h1&#***REMOVED***3E;name&#***REMOVED***3C;/h1&#***REMOVED***3E;&#***REMOVED***27;);
          total.should.equal(223);
          loaded.should.equal(223);
          uploadEventWasFired.should.equal(true);
          done();
        });
    }</code></pre></dd>
            <dt>filesystem errors should be caught</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .attach(&#***REMOVED***27;filedata&#***REMOVED***27;, &#***REMOVED***27;test/node/fi***REMOVED***tures/non-e***REMOVED***istent-file.e***REMOVED***t&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ok(Boolean(err), &#***REMOVED***27;Request should have failed.&#***REMOVED***27;);
          err.code.should.equal(&#***REMOVED***27;ENOENT&#***REMOVED***27;);
          err.path.should.equal(&#***REMOVED***27;test/node/fi***REMOVED***tures/non-e***REMOVED***istent-file.e***REMOVED***t&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>#field(name, val)</h1>
          <dl>
            <dt>should set a multipart field value</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .field(&#***REMOVED***27;first-name&#***REMOVED***27;, &#***REMOVED***27;foo&#***REMOVED***27;)
        .field(&#***REMOVED***27;last-name&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          if (err) done(err);
          res.should.be.ok();
          res.body[&#***REMOVED***27;first-name&#***REMOVED***27;].should.equal(&#***REMOVED***27;foo&#***REMOVED***27;);
          res.body[&#***REMOVED***27;last-name&#***REMOVED***27;].should.equal(&#***REMOVED***27;bar&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>#field(object)</h1>
          <dl>
            <dt>should set multiple multipart fields</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
        .field({ &#***REMOVED***27;first-name&#***REMOVED***27;: &#***REMOVED***27;foo&#***REMOVED***27;, &#***REMOVED***27;last-name&#***REMOVED***27;: &#***REMOVED***27;bar&#***REMOVED***27; })
        .end((err, res) =&#***REMOVED***3E; {
          if (err) done(err);
          res.should.be.ok();
          res.body[&#***REMOVED***27;first-name&#***REMOVED***27;].should.equal(&#***REMOVED***27;foo&#***REMOVED***27;);
          res.body[&#***REMOVED***27;last-name&#***REMOVED***27;].should.equal(&#***REMOVED***27;bar&#***REMOVED***27;);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>with network error</h1>
      <dl>
        <dt>should error</dt>
        <dd><pre><code>request.get(&#***REMOVED***60;http://localhost:${this.port}/&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
  assert(err, &#***REMOVED***27;e***REMOVED***pected an error&#***REMOVED***27;);
  done();
});</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>not modified</h1>
          <dl>
            <dt>should start with 200</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/if-mod&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        res.should.have.status(200);
        res.te***REMOVED***t.should.match(/^\d+$/);
        ts = Number(res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
            <dt>should then be 304</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/if-mod&#***REMOVED***60;)
        .set(&#***REMOVED***27;If-Modified-Since&#***REMOVED***27;, new Date(ts).toUTCString())
        .end((err, res) =&#***REMOVED***3E; {
          res.should.have.status(304);
          // res.te***REMOVED***t.should.be.empty
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>req.parse(fn)</h1>
      <dl>
        <dt>should take precedence over default parsers</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/manny&#***REMOVED***60;)
      .parse(request.parse[&#***REMOVED***27;application/json&#***REMOVED***27;])
      .end((err, res) =&#***REMOVED***3E; {
        assert(res.ok);
        assert.equal(&#***REMOVED***27;{&#***REMOVED***22;name&#***REMOVED***22;:&#***REMOVED***22;manny&#***REMOVED***22;}&#***REMOVED***27;, res.te***REMOVED***t);
        assert.equal(&#***REMOVED***27;manny&#***REMOVED***27;, res.body.name);
        done();
      });
  }</code></pre></dd>
        <dt>should be the only parser</dt>
        <dd><pre><code>request
      .get(&#***REMOVED***60;${base}/image&#***REMOVED***60;)
      .buffer(false)
      .parse((res, fn) =&#***REMOVED***3E; {
        res.on(&#***REMOVED***27;data&#***REMOVED***27;, () =&#***REMOVED***3E; {});
      })
      .then(res =&#***REMOVED***3E; {
        assert(res.ok);
        assert.strictEqual(res.te***REMOVED***t, undefined);
        res.body.should.eql({});
      })</code></pre></dd>
        <dt>should emit error if parser throws</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/manny&#***REMOVED***60;)
      .parse(() =&#***REMOVED***3E; {
        throw new Error(&#***REMOVED***27;I am broken&#***REMOVED***27;);
      })
      .on(&#***REMOVED***27;error&#***REMOVED***27;, err =&#***REMOVED***3E; {
        err.message.should.equal(&#***REMOVED***27;I am broken&#***REMOVED***27;);
        done();
      })
      .end();
  }</code></pre></dd>
        <dt>should emit error if parser returns an error</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/manny&#***REMOVED***60;)
      .parse((res, fn) =&#***REMOVED***3E; {
        fn(new Error(&#***REMOVED***27;I am broken&#***REMOVED***27;));
      })
      .on(&#***REMOVED***27;error&#***REMOVED***27;, err =&#***REMOVED***3E; {
        err.message.should.equal(&#***REMOVED***27;I am broken&#***REMOVED***27;);
        done();
      })
      .end();
  }</code></pre></dd>
        <dt>should not emit error on chunked json</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/chunked-json&#***REMOVED***60;).end(err =&#***REMOVED***3E; {
        assert.ifError(err);
        done();
      });
    }</code></pre></dd>
        <dt>should not emit error on aborted chunked json</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/chunked-json&#***REMOVED***60;);
      req.end(err =&#***REMOVED***3E; {
        assert.ifError(err);
        done();
      });
      setTimeout(() =&#***REMOVED***3E; {
        req.abort();
      }, 50);
    }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>pipe on redirect</h1>
      <dl>
        <dt>should follow Location</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const stream = fs.createWriteStream(destPath);
    const redirects = [];
    const req = request
      .get(base)
      .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
        redirects.push(res.headers.location);
      })
      .connect({
        inapplicable: &#***REMOVED***27;should be ignored&#***REMOVED***27;
      });
    stream.on(&#***REMOVED***27;finish&#***REMOVED***27;, () =&#***REMOVED***3E; {
      redirects.should.eql([&#***REMOVED***27;/movies&#***REMOVED***27;, &#***REMOVED***27;/movies/all&#***REMOVED***27;, &#***REMOVED***27;/movies/all/0&#***REMOVED***27;]);
      fs.readFileSync(destPath, &#***REMOVED***27;utf8&#***REMOVED***27;).should.eql(&#***REMOVED***27;first movie page&#***REMOVED***27;);
      done();
    });
    req.pipe(stream);
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request pipe</h1>
      <dl>
        <dt>should act as a writable stream</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const req = request.post(base);
    const stream = fs.createReadStream(&#***REMOVED***27;test/node/fi***REMOVED***tures/user.json&#***REMOVED***27;);
    req.type(&#***REMOVED***27;json&#***REMOVED***27;);
    req.on(&#***REMOVED***27;response&#***REMOVED***27;, res =&#***REMOVED***3E; {
      res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27; });
      done();
    });
    stream.pipe(req);
  }</code></pre></dd>
        <dt>end() stops piping</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const stream = fs.createWriteStream(destPath);
    request.get(base).end((err, res) =&#***REMOVED***3E; {
      try {
        res.pipe(stream);
        return done(new Error(&#***REMOVED***27;Did not prevent nonsense pipe&#***REMOVED***27;));
      } catch (err2) {
        /* e***REMOVED***pected error */
      }
      done();
    });
  }</code></pre></dd>
        <dt>should act as a readable stream</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const stream = fs.createWriteStream(destPath);
    let responseCalled = false;
    const req = request.get(base);
    req.type(&#***REMOVED***27;json&#***REMOVED***27;);
    req.on(&#***REMOVED***27;response&#***REMOVED***27;, res =&#***REMOVED***3E; {
      res.status.should.eql(200);
      responseCalled = true;
    });
    stream.on(&#***REMOVED***27;finish&#***REMOVED***27;, () =&#***REMOVED***3E; {
      JSON.parse(fs.readFileSync(destPath, &#***REMOVED***27;utf8&#***REMOVED***27;)).should.eql({
        name: &#***REMOVED***27;tobi&#***REMOVED***27;
      });
      responseCalled.should.be.true();
      done();
    });
    req.pipe(stream);
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.query(String)</h1>
      <dl>
        <dt>should support passing in a string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .query(&#***REMOVED***27;name=t%F6bi&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;t%F6bi&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should work with url query-string and string for query</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(&#***REMOVED***60;${base}/?name=tobi&#***REMOVED***60;)
      .query(&#***REMOVED***27;age=2%20&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27;, age: &#***REMOVED***27;2 &#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should support compound elements in a string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .query(&#***REMOVED***27;name=t%F6bi&#***REMOVED***26;age=2&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;t%F6bi&#***REMOVED***27;, age: &#***REMOVED***27;2&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should work when called multiple times with a string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .query(&#***REMOVED***27;name=t%F6bi&#***REMOVED***27;)
      .query(&#***REMOVED***27;age=2%F6&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;t%F6bi&#***REMOVED***27;, age: &#***REMOVED***27;2%F6&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should work with normal &#***REMOVED***60;query&#***REMOVED***60; object and query string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .query(&#***REMOVED***27;name=t%F6bi&#***REMOVED***27;)
      .query({ age: &#***REMOVED***27;2&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;t%F6bi&#***REMOVED***27;, age: &#***REMOVED***27;2&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should not encode raw backticks, but leave encoded ones as is</dt>
        <dd><pre><code>return Promise.all([
  request
    .get(&#***REMOVED***60;${base}/raw-query&#***REMOVED***60;)
    .query(&#***REMOVED***27;name=&#***REMOVED***60;t%60bi&#***REMOVED***60;&#***REMOVED***26;age&#***REMOVED***60;=2&#***REMOVED***27;)
    .then(res =&#***REMOVED***3E; {
      res.te***REMOVED***t.should.eql(&#***REMOVED***27;name=&#***REMOVED***60;t%60bi&#***REMOVED***60;&#***REMOVED***26;age&#***REMOVED***60;=2&#***REMOVED***27;);
    }),
  request.get(base + &#***REMOVED***27;/raw-query?&#***REMOVED***60;age%60&#***REMOVED***60;=2%60&#***REMOVED***60;&#***REMOVED***27;).then(res =&#***REMOVED***3E; {
    res.te***REMOVED***t.should.eql(&#***REMOVED***27;&#***REMOVED***60;age%60&#***REMOVED***60;=2%60&#***REMOVED***60;&#***REMOVED***27;);
  }),
  request
    .get(&#***REMOVED***60;${base}/raw-query&#***REMOVED***60;)
    .query(&#***REMOVED***27;name=&#***REMOVED***60;t%60bi&#***REMOVED***60;&#***REMOVED***27;)
    .query(&#***REMOVED***27;age&#***REMOVED***60;=2&#***REMOVED***27;)
    .then(res =&#***REMOVED***3E; {
      res.te***REMOVED***t.should.eql(&#***REMOVED***27;name=&#***REMOVED***60;t%60bi&#***REMOVED***60;&#***REMOVED***26;age&#***REMOVED***60;=2&#***REMOVED***27;);
    })
]);</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.query(Object)</h1>
      <dl>
        <dt>should construct the query-string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .query({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
      .query({ order: &#***REMOVED***27;asc&#***REMOVED***27; })
      .query({ limit: [&#***REMOVED***27;1&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27;, order: &#***REMOVED***27;asc&#***REMOVED***27;, limit: [&#***REMOVED***27;1&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;] });
        done();
      });
  }</code></pre></dd>
        <dt>should encode raw backticks</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .get(&#***REMOVED***60;${base}/raw-query&#***REMOVED***60;)
      .query({ name: &#***REMOVED***27;&#***REMOVED***60;tobi&#***REMOVED***60;&#***REMOVED***27; })
      .query({ &#***REMOVED***27;orde%60r&#***REMOVED***27;: null })
      .query({ &#***REMOVED***27;&#***REMOVED***60;limit&#***REMOVED***60;&#***REMOVED***27;: [&#***REMOVED***27;%602&#***REMOVED***60;&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;name=%60tobi%60&#***REMOVED***26;orde%2560r&#***REMOVED***26;%60limit%60=%25602%60&#***REMOVED***27;);
        done();
      });
  }</code></pre></dd>
        <dt>should not error on dates</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const date = new Date(0);
    request
      .del(base)
      .query({ at: date })
      .end((err, res) =&#***REMOVED***3E; {
        assert.equal(date.toISOString(), res.body.at);
        done();
      });
  }</code></pre></dd>
        <dt>should work after setting header fields</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(base)
      .set(&#***REMOVED***27;Foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
      .set(&#***REMOVED***27;Bar&#***REMOVED***27;, &#***REMOVED***27;baz&#***REMOVED***27;)
      .query({ name: &#***REMOVED***27;tobi&#***REMOVED***27; })
      .query({ order: &#***REMOVED***27;asc&#***REMOVED***27; })
      .query({ limit: [&#***REMOVED***27;1&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;] })
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27;, order: &#***REMOVED***27;asc&#***REMOVED***27;, limit: [&#***REMOVED***27;1&#***REMOVED***27;, &#***REMOVED***27;2&#***REMOVED***27;] });
        done();
      });
  }</code></pre></dd>
        <dt>should append to the original query-string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(&#***REMOVED***60;${base}/?name=tobi&#***REMOVED***60;)
      .query({ order: &#***REMOVED***27;asc&#***REMOVED***27; })
      .end((err, res) =&#***REMOVED***3E; {
        res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27;, order: &#***REMOVED***27;asc&#***REMOVED***27; });
        done();
      });
  }</code></pre></dd>
        <dt>should retain the original query-string</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.del(&#***REMOVED***60;${base}/?name=tobi&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
      res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27; });
      done();
    });
  }</code></pre></dd>
        <dt>should keep only keys with null querystring values</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .del(&#***REMOVED***60;${base}/url&#***REMOVED***60;)
      .query({ nil: null })
      .end((err, res) =&#***REMOVED***3E; {
        res.te***REMOVED***t.should.equal(&#***REMOVED***27;/url?nil&#***REMOVED***27;);
        done();
      });
  }</code></pre></dd>
        <dt>query-string should be sent on pipe</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const req = request.put(&#***REMOVED***60;${base}/?name=tobi&#***REMOVED***60;);
    const stream = fs.createReadStream(&#***REMOVED***27;test/node/fi***REMOVED***tures/user.json&#***REMOVED***27;);
    req.on(&#***REMOVED***27;response&#***REMOVED***27;, res =&#***REMOVED***3E; {
      res.body.should.eql({ name: &#***REMOVED***27;tobi&#***REMOVED***27; });
      done();
    });
    stream.pipe(req);
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request.get</h1>
      <dl>
        <section class="suite">
          <h1>on 301 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/test-301&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 302 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/test-302&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 303 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/test-303&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 307 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/test-307&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 308 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.get(&#***REMOVED***60;${base}/test-308&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>request.post</h1>
      <dl>
        <section class="suite">
          <h1>on 301 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/test-301&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 302 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/test-302&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 303 redirect</h1>
          <dl>
            <dt>should follow Location with a GET request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/test-303&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;GET&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 307 redirect</h1>
          <dl>
            <dt>should follow Location with a POST request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/test-307&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;POST&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on 308 redirect</h1>
          <dl>
            <dt>should follow Location with a POST request</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const req = request.post(&#***REMOVED***60;${base}/test-308&#***REMOVED***60;).redirects(1);
      req.end((err, res) =&#***REMOVED***3E; {
        req.req._headers.host.should.eql(&#***REMOVED***60;localhost:${server2.address().port}&#***REMOVED***60;);
        res.status.should.eql(200);
        res.te***REMOVED***t.should.eql(&#***REMOVED***27;POST&#***REMOVED***27;);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>request</h1>
      <dl>
        <section class="suite">
          <h1>on redirect</h1>
          <dl>
            <dt>should merge cookies if agent is used</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .agent()
        .get(&#***REMOVED***60;${base}/cookie-redirect&#***REMOVED***60;)
        .set(&#***REMOVED***27;Cookie&#***REMOVED***27;, &#***REMOVED***27;orig=1; replaced=not&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.ifError(err);
            assert(/orig=1/.test(res.te***REMOVED***t), &#***REMOVED***27;orig=1/.test&#***REMOVED***27;);
            assert(/replaced=yes/.test(res.te***REMOVED***t), &#***REMOVED***27;replaced=yes/.test&#***REMOVED***27;);
            assert(/from-redir=1/.test(res.te***REMOVED***t), &#***REMOVED***27;from-redir=1&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should not merge cookies if agent is not used</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/cookie-redirect&#***REMOVED***60;)
        .set(&#***REMOVED***27;Cookie&#***REMOVED***27;, &#***REMOVED***27;orig=1; replaced=not&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert.ifError(err);
            assert(/orig=1/.test(res.te***REMOVED***t), &#***REMOVED***27;/orig=1&#***REMOVED***27;);
            assert(/replaced=not/.test(res.te***REMOVED***t), &#***REMOVED***27;/replaced=not&#***REMOVED***27;);
            assert(!/replaced=yes/.test(res.te***REMOVED***t), &#***REMOVED***27;!/replaced=yes&#***REMOVED***27;);
            assert(!/from-redir/.test(res.te***REMOVED***t), &#***REMOVED***27;!/from-redir&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should have previously set cookie for subsquent requests when agent is used</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const agent = request.agent();
      agent.get(&#***REMOVED***60;${base}/set-cookie&#***REMOVED***60;).end(err =&#***REMOVED***3E; {
        assert.ifError(err);
        agent
          .get(&#***REMOVED***60;${base}/show-cookies&#***REMOVED***60;)
          .set({ Cookie: &#***REMOVED***27;orig=1&#***REMOVED***27; })
          .end((err, res) =&#***REMOVED***3E; {
            try {
              assert.ifError(err);
              assert(/orig=1/.test(res.te***REMOVED***t), &#***REMOVED***27;orig=1/.test&#***REMOVED***27;);
              assert(/persist=123/.test(res.te***REMOVED***t), &#***REMOVED***27;persist=123&#***REMOVED***27;);
              done();
            } catch (err2) {
              done(err2);
            }
          });
      });
    }</code></pre></dd>
            <dt>should follow Location</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const redirects = [];
      request
        .get(base)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          redirects.push(res.headers.location);
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            const arr = [&#***REMOVED***27;/movies&#***REMOVED***27;, &#***REMOVED***27;/movies/all&#***REMOVED***27;, &#***REMOVED***27;/movies/all/0&#***REMOVED***27;];
            redirects.should.eql(arr);
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;first movie page&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should follow Location with IP override</dt>
            <dd><pre><code>const redirects = [];
const url = URL.parse(base);
return request
  .get(&#***REMOVED***60;http://redir.e***REMOVED***ample.com:${url.port || &#***REMOVED***27;80&#***REMOVED***27;}${url.pathname}&#***REMOVED***60;)
  .connect({
    &#***REMOVED***27;*&#***REMOVED***27;: url.hostname
  })
  .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
    redirects.push(res.headers.location);
  })
  .then(res =&#***REMOVED***3E; {
    const arr = [&#***REMOVED***27;/movies&#***REMOVED***27;, &#***REMOVED***27;/movies/all&#***REMOVED***27;, &#***REMOVED***27;/movies/all/0&#***REMOVED***27;];
    redirects.should.eql(arr);
    res.te***REMOVED***t.should.equal(&#***REMOVED***27;first movie page&#***REMOVED***27;);
  });</code></pre></dd>
            <dt>should not follow on HEAD by default</dt>
            <dd><pre><code>const redirects = [];
return request
  .head(base)
  .ok(() =&#***REMOVED***3E; true)
  .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
    redirects.push(res.headers.location);
  })
  .then(res =&#***REMOVED***3E; {
    redirects.should.eql([]);
    res.status.should.equal(302);
  });</code></pre></dd>
            <dt>should follow on HEAD when redirects are set</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const redirects = [];
      request
        .head(base)
        .redirects(10)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          redirects.push(res.headers.location);
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            const arr = [];
            arr.push(&#***REMOVED***27;/movies&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies/all&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies/all/0&#***REMOVED***27;);
            redirects.should.eql(arr);
            assert(!res.te***REMOVED***t);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should remove Content-* fields</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .post(&#***REMOVED***60;${base}/header&#***REMOVED***60;)
        .type(&#***REMOVED***27;t***REMOVED***t&#***REMOVED***27;)
        .set(&#***REMOVED***27;X-Foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;)
        .set(&#***REMOVED***27;X-Bar&#***REMOVED***27;, &#***REMOVED***27;baz&#***REMOVED***27;)
        .send(&#***REMOVED***27;hey&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert(res.body);
            res.body.should.have.property(&#***REMOVED***27;***REMOVED***-foo&#***REMOVED***27;, &#***REMOVED***27;bar&#***REMOVED***27;);
            res.body.should.have.property(&#***REMOVED***27;***REMOVED***-bar&#***REMOVED***27;, &#***REMOVED***27;baz&#***REMOVED***27;);
            res.body.should.not.have.property(&#***REMOVED***27;content-type&#***REMOVED***27;);
            res.body.should.not.have.property(&#***REMOVED***27;content-length&#***REMOVED***27;);
            res.body.should.not.have.property(&#***REMOVED***27;transfer-encoding&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should retain cookies</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/header&#***REMOVED***60;)
        .set(&#***REMOVED***27;Cookie&#***REMOVED***27;, &#***REMOVED***27;foo=bar;&#***REMOVED***27;)
        .end((err, res) =&#***REMOVED***3E; {
          try {
            assert(res.body);
            res.body.should.have.property(&#***REMOVED***27;cookie&#***REMOVED***27;, &#***REMOVED***27;foo=bar;&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should not resend query parameters</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const redirects = [];
      const query = [];
      request
        .get(&#***REMOVED***60;${base}/?foo=bar&#***REMOVED***60;)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          query.push(res.headers.query);
          redirects.push(res.headers.location);
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            const arr = [];
            arr.push(&#***REMOVED***27;/movies&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies/all&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies/all/0&#***REMOVED***27;);
            redirects.should.eql(arr);
            res.te***REMOVED***t.should.equal(&#***REMOVED***27;first movie page&#***REMOVED***27;);
            query.should.eql([&#***REMOVED***27;{&#***REMOVED***22;foo&#***REMOVED***22;:&#***REMOVED***22;bar&#***REMOVED***22;}&#***REMOVED***27;, &#***REMOVED***27;{}&#***REMOVED***27;, &#***REMOVED***27;{}&#***REMOVED***27;]);
            res.headers.query.should.eql(&#***REMOVED***27;{}&#***REMOVED***27;);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
            <dt>should handle no location header</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/bad-redirect&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        try {
          err.message.should.equal(&#***REMOVED***27;No location header for redirect&#***REMOVED***27;);
          done();
        } catch (err2) {
          done(err2);
        }
      });
    }</code></pre></dd>
            <section class="suite">
              <h1>when relative</h1>
              <dl>
                <dt>should redirect to a sibling path</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        const redirects = [];
        request
          .get(&#***REMOVED***60;${base}/relative&#***REMOVED***60;)
          .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
            redirects.push(res.headers.location);
          })
          .end((err, res) =&#***REMOVED***3E; {
            try {
              redirects.should.eql([&#***REMOVED***27;tobi&#***REMOVED***27;]);
              res.te***REMOVED***t.should.equal(&#***REMOVED***27;tobi&#***REMOVED***27;);
              done();
            } catch (err2) {
              done(err2);
            }
          });
      }</code></pre></dd>
                <dt>should redirect to a parent path</dt>
                <dd><pre><code>done =&#***REMOVED***3E; {
        const redirects = [];
        request
          .get(&#***REMOVED***60;${base}/relative/sub&#***REMOVED***60;)
          .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
            redirects.push(res.headers.location);
          })
          .end((err, res) =&#***REMOVED***3E; {
            try {
              redirects.should.eql([&#***REMOVED***27;../tobi&#***REMOVED***27;]);
              res.te***REMOVED***t.should.equal(&#***REMOVED***27;tobi&#***REMOVED***27;);
              done();
            } catch (err2) {
              done(err2);
            }
          });
      }</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
        <section class="suite">
          <h1>req.redirects(n)</h1>
          <dl>
            <dt>should alter the default number of redirects to follow</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      const redirects = [];
      request
        .get(base)
        .redirects(2)
        .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
          redirects.push(res.headers.location);
        })
        .end((err, res) =&#***REMOVED***3E; {
          try {
            const arr = [];
            assert(res.redirect, &#***REMOVED***27;res.redirect&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies&#***REMOVED***27;);
            arr.push(&#***REMOVED***27;/movies/all&#***REMOVED***27;);
            redirects.should.eql(arr);
            res.te***REMOVED***t.should.match(/Moved Temporarily|Found/);
            done();
          } catch (err2) {
            done(err2);
          }
        });
    }</code></pre></dd>
          </dl>
        </section>
        <section class="suite">
          <h1>on POST</h1>
          <dl>
            <dt>should redirect as GET</dt>
            <dd><pre><code>const redirects = [];
return request
  .post(&#***REMOVED***60;${base}/movie&#***REMOVED***60;)
  .send({ name: &#***REMOVED***27;Tobi&#***REMOVED***27; })
  .redirects(2)
  .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
    redirects.push(res.headers.location);
  })
  .then(res =&#***REMOVED***3E; {
    redirects.should.eql([&#***REMOVED***27;/movies/all/0&#***REMOVED***27;]);
    res.te***REMOVED***t.should.equal(&#***REMOVED***27;first movie page&#***REMOVED***27;);
  });</code></pre></dd>
            <dt>using multipart/form-data should redirect as GET</dt>
            <dd><pre><code>const redirects = [];
request
  .post(&#***REMOVED***60;${base}/movie&#***REMOVED***60;)
  .type(&#***REMOVED***27;form&#***REMOVED***27;)
  .field(&#***REMOVED***27;name&#***REMOVED***27;, &#***REMOVED***27;Tobi&#***REMOVED***27;)
  .redirects(2)
  .on(&#***REMOVED***27;redirect&#***REMOVED***27;, res =&#***REMOVED***3E; {
    redirects.push(res.headers.location);
  })
  .then(res =&#***REMOVED***3E; {
    redirects.should.eql([&#***REMOVED***27;/movies/all/0&#***REMOVED***27;]);
    res.te***REMOVED***t.should.equal(&#***REMOVED***27;first movie page&#***REMOVED***27;);
  });</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>response</h1>
      <dl>
        <dt>should act as a readable stream</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    const req = request.get(base).buffer(false);
    req.end((err, res) =&#***REMOVED***3E; {
      if (err) return done(err);
      let trackEndEvent = 0;
      let trackCloseEvent = 0;
      res.on(&#***REMOVED***27;end&#***REMOVED***27;, () =&#***REMOVED***3E; {
        trackEndEvent++;
        trackEndEvent.should.equal(1);
        if (!process.env.HTTP2_TEST) {
          trackCloseEvent.should.equal(0); // close should not have been called
        }
        done();
      });
      res.on(&#***REMOVED***27;close&#***REMOVED***27;, () =&#***REMOVED***3E; {
        trackCloseEvent++;
      });
      (() =&#***REMOVED***3E; {
        res.pause();
      }).should.not.throw();
      (() =&#***REMOVED***3E; {
        res.resume();
      }).should.not.throw();
      (() =&#***REMOVED***3E; {
        res.destroy();
      }).should.not.throw();
    });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>req.serialize(fn)</h1>
      <dl>
        <dt>should take precedence over default parsers</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request
      .post(&#***REMOVED***60;${base}/echo&#***REMOVED***60;)
      .send({ foo: 123 })
      .serialize(data =&#***REMOVED***3E; &#***REMOVED***27;{&#***REMOVED***22;bar&#***REMOVED***22;:456}&#***REMOVED***27;)
      .end((err, res) =&#***REMOVED***3E; {
        assert.ifError(err);
        assert.equal(&#***REMOVED***27;{&#***REMOVED***22;bar&#***REMOVED***22;:456}&#***REMOVED***27;, res.te***REMOVED***t);
        assert.equal(456, res.body.bar);
        done();
      });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>request.get().set()</h1>
      <dl>
        <dt>should set host header after get()</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    app.get(&#***REMOVED***27;/&#***REMOVED***27;, (req, res) =&#***REMOVED***3E; {
      assert.equal(req.hostname, &#***REMOVED***27;e***REMOVED***ample.com&#***REMOVED***27;);
      res.end();
    });
    server = http.createServer(app);
    server.listen(0, function listening() {
      request
        .get(&#***REMOVED***60;http://localhost:${server.address().port}&#***REMOVED***60;)
        .set(&#***REMOVED***27;host&#***REMOVED***27;, &#***REMOVED***27;e***REMOVED***ample.com&#***REMOVED***27;)
        .then(() =&#***REMOVED***3E; {
          return request
            .get(&#***REMOVED***60;http://e***REMOVED***ample.com:${server.address().port}&#***REMOVED***60;)
            .connect({
              &#***REMOVED***27;e***REMOVED***ample.com&#***REMOVED***27;: &#***REMOVED***27;localhost&#***REMOVED***27;,
              &#***REMOVED***27;*&#***REMOVED***27;: &#***REMOVED***27;fail&#***REMOVED***27;
            });
        })
        .then(() =&#***REMOVED***3E; done(), done);
    });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>res.toError()</h1>
      <dl>
        <dt>should return an Error</dt>
        <dd><pre><code>done =&#***REMOVED***3E; {
    request.get(base).end((err, res) =&#***REMOVED***3E; {
      var err = res.toError();
      assert.equal(err.status, 400);
      assert.equal(err.method, &#***REMOVED***27;GET&#***REMOVED***27;);
      assert.equal(err.path, &#***REMOVED***27;/&#***REMOVED***27;);
      assert.equal(err.message, &#***REMOVED***27;cannot GET / (400)&#***REMOVED***27;);
      assert.equal(err.te***REMOVED***t, &#***REMOVED***27;invalid json&#***REMOVED***27;);
      done();
    });
  }</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>[uni***REMOVED***-sockets] http</h1>
      <dl>
        <section class="suite">
          <h1>request</h1>
          <dl>
            <dt>path: / (root)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(res.ok);
        assert.strictEqual(&#***REMOVED***27;root ok!&#***REMOVED***27;, res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
            <dt>path: /request/path</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request.get(&#***REMOVED***60;${base}/request/path&#***REMOVED***60;).end((err, res) =&#***REMOVED***3E; {
        assert(res.ok);
        assert.strictEqual(&#***REMOVED***27;request path ok!&#***REMOVED***27;, res.te***REMOVED***t);
        done();
      });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>[uni***REMOVED***-sockets] https</h1>
      <dl>
        <section class="suite">
          <h1>request</h1>
          <dl>
            <dt>path: / (root)</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/&#***REMOVED***60;)
        .ca(cacert)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert(res.ok);
          assert.strictEqual(&#***REMOVED***27;root ok!&#***REMOVED***27;, res.te***REMOVED***t);
          done();
        });
    }</code></pre></dd>
            <dt>path: /request/path</dt>
            <dd><pre><code>done =&#***REMOVED***3E; {
      request
        .get(&#***REMOVED***60;${base}/request/path&#***REMOVED***60;)
        .ca(cacert)
        .end((err, res) =&#***REMOVED***3E; {
          assert.ifError(err);
          assert(res.ok);
          assert.strictEqual(&#***REMOVED***27;request path ok!&#***REMOVED***27;, res.te***REMOVED***t);
          done();
        });
    }</code></pre></dd>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>req.get()</h1>
      <dl>
        <dt>should set a default user-agent</dt>
        <dd><pre><code>request.get(&#***REMOVED***60;${base}/ua&#***REMOVED***60;).then(res =&#***REMOVED***3E; {
      assert(res.headers);
      assert(res.headers[&#***REMOVED***27;user-agent&#***REMOVED***27;]);
      assert(
        /^node-superagent\/\d+\.\d+\.\d+(?:-[a-z]+\.\d+|$)/.test(
          res.headers[&#***REMOVED***27;user-agent&#***REMOVED***27;]
        )
      );
    })</code></pre></dd>
        <dt>should be able to override user-agent</dt>
        <dd><pre><code>request
      .get(&#***REMOVED***60;${base}/ua&#***REMOVED***60;)
      .set(&#***REMOVED***27;User-Agent&#***REMOVED***27;, &#***REMOVED***27;foo/bar&#***REMOVED***27;)
      .then(res =&#***REMOVED***3E; {
        assert(res.headers);
        assert.equal(res.headers[&#***REMOVED***27;user-agent&#***REMOVED***27;], &#***REMOVED***27;foo/bar&#***REMOVED***27;);
      })</code></pre></dd>
        <dt>should be able to wipe user-agent</dt>
        <dd><pre><code>request
      .get(&#***REMOVED***60;${base}/ua&#***REMOVED***60;)
      .unset(&#***REMOVED***27;User-Agent&#***REMOVED***27;)
      .then(res =&#***REMOVED***3E; {
        assert(res.headers);
        assert.equal(res.headers[&#***REMOVED***27;user-agent&#***REMOVED***27;], void 0);
      })</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>utils.type(str)</h1>
      <dl>
        <dt>should return the mime type</dt>
        <dd><pre><code>utils
  .type(&#***REMOVED***27;application/json; charset=utf-8&#***REMOVED***27;)
  .should.equal(&#***REMOVED***27;application/json&#***REMOVED***27;);
utils.type(&#***REMOVED***27;application/json&#***REMOVED***27;).should.equal(&#***REMOVED***27;application/json&#***REMOVED***27;);</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>utils.params(str)</h1>
      <dl>
        <dt>should return the field parameters</dt>
        <dd><pre><code>const obj = utils.params(&#***REMOVED***27;application/json; charset=utf-8; foo  = bar&#***REMOVED***27;);
obj.charset.should.equal(&#***REMOVED***27;utf-8&#***REMOVED***27;);
obj.foo.should.equal(&#***REMOVED***27;bar&#***REMOVED***27;);
utils.params(&#***REMOVED***27;application/json&#***REMOVED***27;).should.eql({});</code></pre></dd>
      </dl>
    </section>
    <section class="suite">
      <h1>utils.parseLinks(str)</h1>
      <dl>
        <dt>should parse links</dt>
        <dd><pre><code>const str =
  &#***REMOVED***27;&#***REMOVED***3C;https://api.github.com/repos/visionmedia/mocha/issues?page=2&#***REMOVED***3E;; rel=&#***REMOVED***22;ne***REMOVED***t&#***REMOVED***22;, &#***REMOVED***3C;https://api.github.com/repos/visionmedia/mocha/issues?page=5&#***REMOVED***3E;; rel=&#***REMOVED***22;last&#***REMOVED***22;&#***REMOVED***27;;
const ret = utils.parseLinks(str);
ret.ne***REMOVED***t.should.equal(
  &#***REMOVED***27;https://api.github.com/repos/visionmedia/mocha/issues?page=2&#***REMOVED***27;
);
ret.last.should.equal(
  &#***REMOVED***27;https://api.github.com/repos/visionmedia/mocha/issues?page=5&#***REMOVED***27;
);</code></pre></dd>
      </dl>
    </section>
    </div>
    <a href="http://github.com/visionmedia/superagent"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
    <script src="https://cdnjs.cloudflare.com/aja***REMOVED***/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      $('code').each(function(){
        $(this).html(highlight($(this).te***REMOVED***t()));
      });

      function highlight(js) {
        return js
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/('.*?')/gm, '<span class="string">$1</span>')
          .replace(/(\d+\.\d+)/gm, '<span class="number">$1</span>')
          .replace(/(\d+)/gm, '<span class="number">$1</span>')
          .replace(/\bnew *(\w+)/gm, '<span class="keyword">new</span> <span class="init">$1</span>')
          .replace(/\b(function|new|throw|return|var|if|else)\b/gm, '<span class="keyword">$1</span>')
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/aja***REMOVED***/libs/tocbot/3.0.0/tocbot.js"></script>
    <script>
      // Only use tocbot for main docs, not test docs
      if (document.querySelector('#superagent')) {
        tocbot.init({
          // Where to render the table of contents.
          tocSelector: '#menu',
          // Where to grab the headings to build the table of contents.
          contentSelector: '#content',
          // Which headings to grab inside of the contentSelector element.
          headingSelector: 'h2',
          smoothScroll: false
        });
      }
    </script>
  </body>
</html>
