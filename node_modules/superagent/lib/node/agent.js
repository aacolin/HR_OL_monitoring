"use strict";

/**
 * Module dependencies.
 */
// eslint-disable-ne***REMOVED***t-line node/no-deprecated-api
var _require = require('url'),
    parse = _require.parse;

var _require2 = require('cookiejar'),
    CookieJar = _require2.CookieJar;

var _require3 = require('cookiejar'),
    CookieAccessInfo = _require3.CookieAccessInfo;

var methods = require('methods');

var request = require('../..');

var AgentBase = require('../agent-base');
/**
 * E***REMOVED***pose `Agent`.
 */


module.e***REMOVED***ports = Agent;
/**
 * Initialize a new `Agent`.
 *
 * @api public
 */

function Agent(options) {
  if (!(this instanceof Agent)) {
    return new Agent(options);
  }

  AgentBase.call(this);
  this.jar = new CookieJar();

  if (options) {
    if (options.ca) {
      this.ca(options.ca);
    }

    if (options.key) {
      this.key(options.key);
    }

    if (options.pf***REMOVED***) {
      this.pf***REMOVED***(options.pf***REMOVED***);
    }

    if (options.cert) {
      this.cert(options.cert);
    }

    if (options.rejectUnauthorized === false) {
      this.disableTLSCerts();
    }
  }
}

Agent.prototype = Object.create(AgentBase.prototype);
/**
 * Save the cookies in the given `res` to
 * the agent's cookie jar for persistence.
 *
 * @param {Response} res
 * @api private
 */

Agent.prototype._saveCookies = function (res) {
  var cookies = res.headers['set-cookie'];
  if (cookies) this.jar.setCookies(cookies);
};
/**
 * Attach cookies when available to the given `req`.
 *
 * @param {Request} req
 * @api private
 */


Agent.prototype._attachCookies = function (req) {
  var url = parse(req.url);
  var access = new CookieAccessInfo(url.hostname, url.pathname, url.protocol === 'https:');
  var cookies = this.jar.getCookies(access).toValueString();
  req.cookies = cookies;
};

methods.forEach(function (name) {
  var method = name.toUpperCase();

  Agent.prototype[name] = function (url, fn) {
    var req = new request.Request(method, url);
    req.on('response', this._saveCookies.bind(this));
    req.on('redirect', this._saveCookies.bind(this));
    req.on('redirect', this._attachCookies.bind(this, req));

    this._setDefaults(req);

    this._attachCookies(req);

    if (fn) {
      req.end(fn);
    }

    return req;
  };
});
Agent.prototype.del = Agent.prototype.delete;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ub2RlL2FnZW50LmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJwYXJzZSIsIkNvb2tpZUphciIsIkNvb2tpZUFjY2Vzc0luZm8iLCJtZXRob2RzIiwicmV***REMOVED***dWVzdCIsIkFnZW50QmFzZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJBZ2VudCIsIm9wdGlvbnMiLCJjYW***REMOVED***sIiwiamFyIiwiY2EiLCJrZXkiLCJwZngiLCJjZXJ0IiwicmVqZWN0VW5hdXRob3JpemVkIiwiZGlzYWJsZVRMU0NlcnRzIiwicHJvdG90eXBlIiwiT2JqZWN0IiwiY3JlYXRlIiwiX3NhdmVDb29raWVzIiwicmVzIiwiY29va2llcyIsImhlYWRlcnMiLCJzZXRDb29raWVzIiwiX2F0dGFjaENvb2tpZXMiLCJyZXEiLCJ1cmwiLCJhY2Nlc3MiLCJob3N0bmFtZSIsInBhdGhuYW1lIiwicHJvdG9jb2wiLCJnZXRDb29raWVzIiwidG9WYW***REMOVED***1ZVN0cmluZyIsImZvckVhY2giLCJuYW1lIiwibWV0aG9kIiwidG9VcHBlckNhc2UiLCJmbiIsIlJlcXVlc3QiLCJvbiIsImJpbmQiLCJfc2V0RGVmYXVsdHMiLCJlbmQiLCJkZWwiLCJkZW***REMOVED***ldGUiXSwibWFwcGluZ3MiOiI7O0FBQUE7OztBQUlBO2VBQ2tCQS***REMOVED***PQUFPLENBQUMsS0FBRC***REMOVED***DO0lBQWpCQy***REMOVED***LLFlBQUFBLEs7O2dCQUNjRC***REMOVED***PQUFPLENBQUMsV0FBRC***REMOVED***DO0lBQXJCRS***REMOVED***TLGFBQUFBLFM7O2dCQUN***REMOVED***QkYsT0FBTy***REMOVED***DQUFDLFdBQUQsQztJQUE1QkcsZ0IsYUFBQUEsZ0I7O0FBQ1IsSUFBTUMsT0FBTy***REMOVED***HQUFHSi***REMOVED***PQUFPLENBQUMsU0FBRC***REMOVED***DQUF2Qjs7QUFDQS***REMOVED***JQUFNSy***REMOVED***PQUFPLEdBQUdMLE9BQU8sQ0FBQy***REMOVED***PQUFELENBQXZCOztBQUNBLElBQU1NLFNBQVMsR0FBR04sT0FBTy***REMOVED***DQUFDLGVBQUQsQ0FBekI7QUFFQTs7Ozs7QUFJQU8sTUFBTS***REMOVED***DQUFDQy***REMOVED***PQUFQLEdBQWlCQy***REMOVED***LQUFqQjtBQUVBOzs7Ozs7QUFNQS***REMOVED***TQUFTQS***REMOVED***LQUFULENBQWVDLE9BQWYsRUFBd0I7QUFDdEIsTUFBSS***REMOVED***FQUFFLGdCQUFnQkQsS0FBbEIsQ0FBSi***REMOVED***FQUE4QjtBQUM1Qi***REMOVED***XQUFPLElBQUlBLEtBQUosQ0FBVUMsT0FBVi***REMOVED***DQUFQO0FBQ0Q7O0FBRURKLEVBQUFBLFNBQVMsQ0FBQ0ssSUFBVi***REMOVED***DQUFlLElBQWY7QUFDQS***REMOVED***PQUFLQy***REMOVED***HQUFMLEdBQVcsSUFBSVYsU0FBSi***REMOVED***FQUFYOztBQUVBLE1BQUlRLE9BQUosRUFBYTtBQUNYLFFBQUlBLE9BQU8sQ0FBQ0csRUFBWi***REMOVED***FQUFnQjtBQUNkLFdBQUtBLEVBQUwsQ0FBUUgsT0FBTy***REMOVED***DQUFDRy***REMOVED***FQUFoQjtBQUNEOztBQUVELFFBQUlILE9BQU8sQ0FBQ0ksR0FBWi***REMOVED***FQUFpQjtBQUNmLFdBQUtBLEdBQUwsQ0FBU0osT0FBTy***REMOVED***DQUFDSS***REMOVED***HQUFqQjtBQUNEOztBQUVELFFBQUlKLE9BQU8sQ0FBQ0ssR0FBWi***REMOVED***FQUFpQjtBQUNmLFdBQUtBLEdBQUwsQ0FBU0wsT0FBTy***REMOVED***DQUFDSy***REMOVED***HQUFqQjtBQUNEOztBQUVELFFBQUlMLE9BQU8sQ0FBQ00sSUFBWi***REMOVED***FQUFrQjtBQUNoQi***REMOVED***XQUFLQS***REMOVED***JQUFMLENBQVVOLE9BQU8sQ0FBQ00sSUFBbEI7QUFDRDs7QUFFRC***REMOVED***RQUFJTi***REMOVED***PQUFPLENBQUNPLGtCQUFSLEtBQStCLEtBQW5DLEVBQTBDO0FBQ3hDLFdBQUtDLGVBQUw7QUFDRDtBQUNGO0FBQ0Y7O0FBRURULEtBQUssQ0FBQ1UsU0FBTi***REMOVED***HQUFrQkMsTUFBTS***REMOVED***DQUFDQy***REMOVED***NQUFQLENBQWNmLFNBQVMsQ0FBQ2EsU0FBeEIsQ0FBbEI7QUFFQTs7Ozs7Ozs7QUFRQVYsS0FBSy***REMOVED***DQUFDVS***REMOVED***TQUFOLENBQWdCRy***REMOVED***ZQUFoQi***REMOVED***HQUErQi***REMOVED***VQUFTQy***REMOVED***HQUFULEVBQWM7QUFDM0MsTUFBTUMsT0FBTy***REMOVED***HQUFHRC***REMOVED***HQUFHLENBQUNFLE9BQUosQ0FBWS***REMOVED***ZQUFaLENBQWhCO0FBQ0EsTUFBSUQsT0FBSi***REMOVED***FQUFhLEtBQUtaLEdBQUwsQ0FBU2MsVUFBVC***REMOVED***DQUFvQkYsT0FBcEI7QUFDZC***REMOVED***DQUhEO0FBS0E7Ozs7Ozs7O0FBT0FmLEtBQUssQ0FBQ1UsU0FBTi***REMOVED***DQUFnQlEsY0FBaEIsR0FBaUMsVUFBU0MsR0FBVC***REMOVED***FQUFjO0FBQzdDLE1BQU1DLEdBQUcsR0FBRzVCLEtBQUssQ0FBQzJCLEdBQUcsQ0FBQ0MsR0FBTC***REMOVED***DQUFqQjtBQUNBLE1BQU1DLE1BQU0sR0FBRy***REMOVED***JQUFJM0IsZ0JBQUosQ0FDYjBCLEdBQUcsQ0FBQ0UsUUFEUy***REMOVED***FQUViRi***REMOVED***HQUFHLENBQUNHLFFBRlMsRUFHYkgsR0FBRy***REMOVED***DQUFDSS***REMOVED***RQUFKLEtBQWlCLFFBSEosQ0FBZjtBQUtBLE1BQU1ULE9BQU8sR0FBRy***REMOVED***LQUFLWi***REMOVED***HQUFMLENBQVNzQi***REMOVED***VQUFULENBQW9CSi***REMOVED***NQUFwQi***REMOVED***FQUE0QkssYUFBNUIsRUFBaEI7QUFDQVAsRUFBQUEsR0FBRy***REMOVED***DQUFDSi***REMOVED***PQUFKLEdBQWNBLE9BQWQ7QUFDRC***REMOVED***DQVREOztBQVdBcEIsT0FBTy***REMOVED***DQUFDZ0MsT0FBUi***REMOVED***DQUFnQi***REMOVED***VQUFBQy***REMOVED***JQUFJLEVBQUk7QUFDdEIsTUFBTUMsTUFBTS***REMOVED***HQUFHRC***REMOVED***JQUFJLENBQUNFLFdBQUwsRUFBZjs7QUFDQTlCLEVBQUFBLEtBQUssQ0FBQ1UsU0FBTi***REMOVED***DQUFnQmtCLElBQWhCLElBQXdCLFVBQVNSLEdBQVQsRUFBY1csRUFBZC***REMOVED***FQUFrQjtBQUN4Qy***REMOVED***RQUFNWi***REMOVED***HQUFHLEdBQUcsSUFBSXZCLE9BQU8sQ0FBQ29DLE9BQVosQ0FBb0JILE1BQXBCLEVBQTRCVC***REMOVED***HQUE1Qi***REMOVED***DQUFaO0FBRUFELElBQUFBLEdBQUcsQ0FBQ2MsRUFBSi***REMOVED***DQUFPLFVBQVAsRUFBbUIsS0FBS3BCLFlBQUwsQ0FBa0J***REMOVED***Qi***REMOVED***JQUFsQi***REMOVED***DQUF1Qi***REMOVED***JQUF2Qi***REMOVED***DQUFuQjtBQUNBZi***REMOVED***JQUFBQS***REMOVED***HQUFHLENBQUNjLEVBQUosQ0FBTy***REMOVED***VQUFQLEVBQW1CLEtBQUtwQi***REMOVED***ZQUFMLENBQWtCcUIsSUFBbEIsQ0FBdUIsSUFBdkIsQ0FBbkI7QUFDQWYsSUFBQUEsR0FBRy***REMOVED***DQUFDYy***REMOVED***FQUFKLENBQU8sVUFBUC***REMOVED***FQUFtQi***REMOVED***LQUFLZi***REMOVED***jQUFMLENBQW9CZ0IsSUFBcEIsQ0FBeUIsSUFBekIsRUFBK0JmLEdBQS9CLENBQW5COztBQUNBLFNBQUtnQi***REMOVED***ZQUFMLENBQWtCaEIsR0FBbEI7O0FBQ0EsU0FBS0QsY0FBTC***REMOVED***DQUFvQkMsR0FBcEI7O0FBRUEsUUFBSVksRUFBSi***REMOVED***FQUFRO0FBQ05aLE1BQUFBLEdBQUcsQ0FBQ2lCLEdBQUosQ0FBUUwsRUFBUjtBQUNEOztBQUVELFdBQU9aLEdBQVA7QUFDRC***REMOVED***HQWREO0FBZUQsQ0FqQkQ7QUFtQkFuQi***REMOVED***LQUFLLENBQUNVLFNBQU4sQ0FBZ0IyQi***REMOVED***HQUFoQi***REMOVED***HQUFzQnJDLEtBQUssQ0FBQ1UsU0FBTi***REMOVED***DQUFnQjRCLE1BQXRDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2R1bGUgZGVwZW5kZW5jaWVzLl***REMOVED***uICovXG5cbi8vIGVzbGludC1kaXNhYm***REMOVED***lLW5leHQtbGluZSBub2RlL25vLWRlcHJlY2F0ZWQtYXBpXG5jb25zdCB7IHBhcnNlIH0gPSByZXF1aXJlKCd1cmwnKTtcbmNvbnN0IHsgQ29va2llSmFyIH0gPSByZXF1aXJlKCdjb29raWVqYXInKTtcbmNvbnN0IHsgQ29va2llQWNjZXNzSW5mbyB9ID0gcmV***REMOVED***dWlyZSgnY29va2llamFyJyk7XG5jb25zdCBtZXRob2RzID0gcmV***REMOVED***dWlyZSgnbWV0aG9kcycpO1***REMOVED***uY29uc3QgcmV***REMOVED***dWVzdCA9IHJlcXVpcmUoJy4uLy4uJyk7XG5jb25zdCBBZ2VudEJhc2UgPSByZXF1aXJlKCcuLi9hZ2VudC1iYXNlJyk7XG5cbi8qKl***REMOVED***uICogRXhwb3NlIGBBZ2VudGAuXG4gKi9cbl***REMOVED***ubW9kdW***REMOVED***lLmV4cG9ydHMgPSBBZ2VudDtcbl***REMOVED***uLyoqXG4gKiBJbml0aWFsaXplIGEgbmV3IGBBZ2VudGAuXG4gKl***REMOVED***uICogQGFwaSBwdWJsaWNcbiAqL1***REMOVED***uXG5mdW5jdGlvbiBBZ2VudChvcHRpb25zKSB7XG4gIGlmICghKHRoaXMgaW5zdGFuY2VvZiBBZ2VudCkpIHtcbiAgICByZXR1cm4gbmV3IEFnZW50KG9wdGlvbnMpO1***REMOVED***uICB9XG5cbiAgQWdlbnRCYXNlLmNhbGwodGhpcyk7XG4gIHRoaXMuamFyID0gbmV3IENvb2tpZUphcigpO1***REMOVED***uXG4gIGlmIChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMuY2EpIHtcbiAgICAgIHRoaXMuY2Eob3B0aW9ucy5jYSk7XG4gICAgfV***REMOVED***uXG4gICAgaWYgKG9wdGlvbnMua2V5KSB7XG4gICAgICB0aGlzLmtleShvcHRpb25zLmtleSk7XG4gICAgfV***REMOVED***uXG4gICAgaWYgKG9wdGlvbnMucGZ4KSB7XG4gICAgICB0aGlzLnBmeChvcHRpb25zLnBmeCk7XG4gICAgfV***REMOVED***uXG4gICAgaWYgKG9wdGlvbnMuY2VydCkge1***REMOVED***uICAgICAgdGhpcy5jZXJ0KG9wdGlvbnMuY2VydCk7XG4gICAgfV***REMOVED***uXG4gICAgaWYgKG9wdGlvbnMucmVqZWN0VW5hdXRob3JpemVkID09PSBmYW***REMOVED***zZSkge1***REMOVED***uICAgICAgdGhpcy5kaXNhYm***REMOVED***lVE***REMOVED***TQ2VydHMoKTtcbiAgICB9XG4gIH1cbn1cbl***REMOVED***uQWdlbnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShBZ2VudEJhc2UucHJvdG90eXBlKTtcbl***REMOVED***uLyoqXG4gKiBTYXZlIHRoZSBjb29raWVzIGluIHRoZSBnaXZlbiBgcmVzYCB0b1***REMOVED***uICogdGhlIGFnZW50J3MgY29va2llIGphciBmb3IgcGVyc2lzdGVuY2UuXG4gKl***REMOVED***uICogQHBhcmFtIHtSZXNwb25zZX0gcmVzXG4gKiBAYXBpIHByaXZhdGVcbiAqL1***REMOVED***uXG5BZ2VudC5wcm90b3R5cGUuX3NhdmVDb29raWVzID0gZnVuY3Rpb24ocmVzKSB7XG4gIGNvbnN0IGNvb2tpZXMgPSByZXMuaGVhZGVyc1snc2V0LWNvb2tpZSddO1***REMOVED***uICBpZiAoY29va2llcykgdGhpcy5qYXIuc2V0Q29va2llcyhjb29raWVzKTtcbn07XG5cbi8qKl***REMOVED***uICogQXR0YWNoIGNvb2tpZXMgd2hlbiBhdmFpbGFibGUgdG8gdGhlIGdpdmVuIGByZXFgLl***REMOVED***uICpcbiAqIEBwYXJhbSB7UmV***REMOVED***dWVzdH0gcmV***REMOVED***XG4gKiBAYXBpIHByaXZhdGVcbiAqL1***REMOVED***uXG5BZ2VudC5wcm90b3R5cGUuX2F0dGFjaENvb2tpZXMgPSBmdW5jdGlvbihyZXEpIHtcbiAgY29uc3QgdXJsID0gcGFyc2UocmV***REMOVED***LnVybCk7XG4gIGNvbnN0IGFjY2VzcyA9IG5ldyBDb29raWVBY2Nlc3NJbmZvKF***REMOVED***uICAgIHVybC5ob3N0bmFtZS***REMOVED***cbiAgICB1cmwucGF0aG5hbWUsXG4gICAgdXJsLnByb3RvY29sID09PSAnaHR0cHM6J1***REMOVED***uICApO1***REMOVED***uICBjb25zdCBjb29raWVzID0gdGhpcy5qYXIuZ2V0Q29va2llcyhhY2Nlc3MpLnRvVmFsdWVTdHJpbmcoKTtcbiAgcmV***REMOVED***LmNvb2tpZXMgPSBjb29raWVzO1***REMOVED***ufTtcbl***REMOVED***ubWV0aG9kcy5mb3JFYWNoKG5hbWUgPT4ge1***REMOVED***uICBjb25zdCBtZXRob2QgPSBuYW1lLnRvVXBwZXJDYXNlKCk7XG4gIEFnZW50LnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKHVybCwgZm4pIHtcbiAgICBjb25zdCByZXEgPSBuZXcgcmV***REMOVED***dWVzdC5SZXF1ZXN0KG1ldGhvZCwgdXJsKTtcbl***REMOVED***uICAgIHJlcS5vbigncmVzcG9uc2UnLCB0aGlzLl9zYXZlQ29va2llcy5iaW5kKHRoaXMpKTtcbiAgICByZXEub24oJ3JlZGlyZWN0JywgdGhpcy5fc2F2ZUNvb2tpZXMuYmluZCh0aGlzKSk7XG4gICAgcmV***REMOVED***Lm9uKCdyZWRpcmVjdCcsIHRoaXMuX2F0dGFjaENvb2tpZXMuYmluZCh0aGlzLCByZXEpKTtcbiAgICB0aGlzLl9zZXREZWZhdW***REMOVED***0cyhyZXEpO1***REMOVED***uICAgIHRoaXMuX2F0dGFjaENvb2tpZXMocmV***REMOVED***KTtcbl***REMOVED***uICAgIGlmIChmbikge1***REMOVED***uICAgICAgcmV***REMOVED***LmVuZChmbik7XG4gICAgfV***REMOVED***uXG4gICAgcmV0dXJuIHJlcTtcbiAgfTtcbn0pO1***REMOVED***uXG5BZ2VudC5wcm90b3R5cGUuZGVsID0gQWdlbnQucHJvdG90eXBlLmRlbGV0ZTtcbiJdfQ==