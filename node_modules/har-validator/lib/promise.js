var Ajv = require('ajv')
var HARError = require('./error')
var schemas = require('har-schema')

var ajv

function createAjvInstance () {
  var ajv = new Ajv({
    allErrors: true
  })
  ajv.addMetaSchema(require('ajv/lib/refs/json-schema-draft-06.json'))
  ajv.addSchema(schemas)

  return ajv
}

function validate (name, data) {
  data = data || {}

  // validator config
  ajv = ajv || createAjvInstance()

  var validate = ajv.getSchema(name + '.json')

  return new Promise(function (resolve, reject) {
    var valid = validate(data)

    !valid ? reject(new HARError(validate.errors)) : resolve(data)
  })
}

e***REMOVED***ports.afterRequest = function (data) {
  return validate('afterRequest', data)
}

e***REMOVED***ports.beforeRequest = function (data) {
  return validate('beforeRequest', data)
}

e***REMOVED***ports.browser = function (data) {
  return validate('browser', data)
}

e***REMOVED***ports.cache = function (data) {
  return validate('cache', data)
}

e***REMOVED***ports.content = function (data) {
  return validate('content', data)
}

e***REMOVED***ports.cookie = function (data) {
  return validate('cookie', data)
}

e***REMOVED***ports.creator = function (data) {
  return validate('creator', data)
}

e***REMOVED***ports.entry = function (data) {
  return validate('entry', data)
}

e***REMOVED***ports.har = function (data) {
  return validate('har', data)
}

e***REMOVED***ports.header = function (data) {
  return validate('header', data)
}

e***REMOVED***ports.log = function (data) {
  return validate('log', data)
}

e***REMOVED***ports.page = function (data) {
  return validate('page', data)
}

e***REMOVED***ports.pageTimings = function (data) {
  return validate('pageTimings', data)
}

e***REMOVED***ports.postData = function (data) {
  return validate('postData', data)
}

e***REMOVED***ports.query = function (data) {
  return validate('query', data)
}

e***REMOVED***ports.request = function (data) {
  return validate('request', data)
}

e***REMOVED***ports.response = function (data) {
  return validate('response', data)
}

e***REMOVED***ports.timings = function (data) {
  return validate('timings', data)
}
