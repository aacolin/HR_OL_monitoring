import { e***REMOVED***pect, sinon } from './test-setup';
import Particle from '../src/Particle';


describe('Particle', () => {
	let api;

	beforeEach(() => {
		api = new Particle();
	});

	describe('downloadFile', () => {
		it('download the file', () => {
			const uri = 'https://s3.amazonaws.com/binaries.particle.io/libraries/neopi***REMOVED***el/neopi***REMOVED***el-0.0.10.tar.gz';
			const fileSize = 25505;
			return api.downloadFile({ uri })
				.then(contents => {
					e***REMOVED***pect(contents.length || contents.byteLength).to.equal(fileSize);
				});
		});
	});

	describe('conte***REMOVED***t', () => {
		it('adds headers for the conte***REMOVED***t', () => {
			api.setConte***REMOVED***t('tool', { name:'cli', version:'1.2.3' });
			api.setConte***REMOVED***t('project', { name:'blinky', version:'0.0.1' });
			api.agent._promiseResponse = sinon.stub().resolves();
			return api.flashTinker('deviceID', 'auth').then(() => {
				e***REMOVED***pect(api.agent._promiseResponse).to.have.been.calledOnce;
				const req = api.agent._promiseResponse.firstCall.args[0];
				e***REMOVED***pect(req).to.be.ok;
				e***REMOVED***pect(req.header).to.have.property('X-Particle-Tool').eql('cli@1.2.3');
				e***REMOVED***pect(req.header).to.have.property('X-Particle-Project').eql('blinky; version=0.0.1');
			});
		});
	});
});
