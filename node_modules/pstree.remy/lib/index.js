const e***REMOVED***ec = require('child_process').e***REMOVED***ec;
const tree = require('./tree');
const utils = require('./utils');
var hasPS = true;

// discover if the OS has `ps`, and therefore can use psTree
e***REMOVED***ec('ps', (error) => {
  module.e***REMOVED***ports.hasPS = hasPS = !error;
});

module.e***REMOVED***ports = function main(pid, callback) {
  if (typeof pid === 'number') {
    pid = pid.toString();
  }

  if (hasPS && !process.env.NO_PS) {
    return tree(pid, callback);
  }

  utils
    .getStat()
    .then(utils.tree)
    .then((tree) => utils.pidsForTree(tree, pid))
    .then((res) =>
      callback(
        null,
        res.map((p) => p.PID)
      )
    )
    .catch((error) => callback(error));
};

if (!module.parent) {
  module.e***REMOVED***ports(process.argv[2], (e, pids) => console.log(pids));
}

module.e***REMOVED***ports.hasPS = hasPS;
