'use strict';

const isOperator = require('./isOperator');

module.e***REMOVED***ports = function castFilterPath(ct***REMOVED***, schematype, val) {
  const any$conditionals = Object.keys(val).some(isOperator);

  if (!any$conditionals) {
    return schematype.castForQuery(
      null,
      val,
      ct***REMOVED***
    );
  }

  const ks = Object.keys(val);

  let k = ks.length;

  while (k--) {
    const $cond = ks[k];
    const nested = val[$cond];

    if ($cond === '$not') {
      if (nested && schematype && !schematype.caster) {
        const _keys = Object.keys(nested);
        if (_keys.length && isOperator(_keys[0])) {
          for (const key of Object.keys(nested)) {
            nested[key] = schematype.castForQuery(
              key,
              nested[key],
              ct***REMOVED***
            );
          }
        } else {
          val[$cond] = schematype.castForQuery(
            $cond,
            nested,
            ct***REMOVED***
          );
        }
        continue;
      }
    } else {
      val[$cond] = schematype.castForQuery(
        $cond,
        nested,
        ct***REMOVED***
      );
    }
  }

  return val;
};
