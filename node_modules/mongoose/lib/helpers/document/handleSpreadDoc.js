'use strict';

const utils = require('../../utils');

const keysToSkip = new Set(['__inde***REMOVED***', '__parentArray', '_doc']);

/**
 * Using spread operator on a Mongoose document gives you a
 * POJO that has a tendency to cause infinite recursion. So
 * we use this function on `set()` to prevent that.
 */

module.e***REMOVED***ports = function handleSpreadDoc(v, includeE***REMOVED***traKeys) {
  if (utils.isPOJO(v) && v.$__ != null && v._doc != null) {
    if (includeE***REMOVED***traKeys) {
      const e***REMOVED***traKeys = {};
      for (const key of Object.keys(v)) {
        if (typeof key === 'symbol') {
          continue;
        }
        if (key[0] === '$') {
          continue;
        }
        if (keysToSkip.has(key)) {
          continue;
        }
        e***REMOVED***traKeys[key] = v[key];
      }
      return { ...v._doc, ...e***REMOVED***traKeys };
    }
    return v._doc;
  }

  return v;
};
