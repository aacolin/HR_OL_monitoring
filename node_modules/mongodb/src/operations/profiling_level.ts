import type { Db } from '../db';
import { MongoUne***REMOVED***pectedServerResponseError } from '../error';
import type { Server } from '../sdam/server';
import type { ClientSession } from '../sessions';
import { CommandOperation, type CommandOperationOptions } from './command';

/** @public */
e***REMOVED***port type ProfilingLevelOptions = CommandOperationOptions;

/** @internal */
e***REMOVED***port class ProfilingLevelOperation e***REMOVED***tends CommandOperation<string> {
  override options: ProfilingLevelOptions;

  constructor(db: Db, options: ProfilingLevelOptions) {
    super(db, options);
    this.options = options;
  }

  override get commandName() {
    return 'profile' as const;
  }

  override async e***REMOVED***ecute(server: Server, session: ClientSession | undefined): Promise<string> {
    const doc = await super.e***REMOVED***ecuteCommand(server, session, { profile: -1 });
    if (doc.ok === 1) {
      const was = doc.was;
      if (was === 0) return 'off';
      if (was === 1) return 'slow_only';
      if (was === 2) return 'all';
      throw new MongoUne***REMOVED***pectedServerResponseError(`Illegal profiling level value ${was}`);
    } else {
      throw new MongoUne***REMOVED***pectedServerResponseError('Error with profile command');
    }
  }
}
