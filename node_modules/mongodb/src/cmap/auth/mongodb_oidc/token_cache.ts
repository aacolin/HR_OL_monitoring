import { MongoDriverError } from '../../../error';
import type { IdPInfo, OIDCResponse } from '../mongodb_oidc';

class MongoOIDCError e***REMOVED***tends MongoDriverError {}

/** @internal */
e***REMOVED***port class TokenCache {
  private accessToken?: string;
  private refreshToken?: string;
  private idpInfo?: IdPInfo;
  private e***REMOVED***piresInSeconds?: number;

  get hasAccessToken(): boolean {
    return !!this.accessToken;
  }

  get hasRefreshToken(): boolean {
    return !!this.refreshToken;
  }

  get hasIdpInfo(): boolean {
    return !!this.idpInfo;
  }

  getAccessToken(): string {
    if (!this.accessToken) {
      throw new MongoOIDCError('Attempted to get an access token when none e***REMOVED***ists.');
    }
    return this.accessToken;
  }

  getRefreshToken(): string {
    if (!this.refreshToken) {
      throw new MongoOIDCError('Attempted to get a refresh token when none e***REMOVED***ists.');
    }
    return this.refreshToken;
  }

  getIdpInfo(): IdPInfo {
    if (!this.idpInfo) {
      throw new MongoOIDCError('Attempted to get IDP information when none e***REMOVED***ists.');
    }
    return this.idpInfo;
  }

  put(response: OIDCResponse, idpInfo?: IdPInfo) {
    this.accessToken = response.accessToken;
    this.refreshToken = response.refreshToken;
    this.e***REMOVED***piresInSeconds = response.e***REMOVED***piresInSeconds;
    if (idpInfo) {
      this.idpInfo = idpInfo;
    }
  }

  removeAccessToken() {
    this.accessToken = undefined;
  }

  removeRefreshToken() {
    this.refreshToken = undefined;
  }
}
