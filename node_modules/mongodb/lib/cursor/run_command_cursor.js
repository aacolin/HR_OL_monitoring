"use strict";
Object.defineProperty(e***REMOVED***ports, "__esModule", { value: true });
e***REMOVED***ports.RunCommandCursor = void 0;
const responses_1 = require("../cmap/wire_protocol/responses");
const error_1 = require("../error");
const e***REMOVED***ecute_operation_1 = require("../operations/e***REMOVED***ecute_operation");
const get_more_1 = require("../operations/get_more");
const run_command_1 = require("../operations/run_command");
const utils_1 = require("../utils");
const abstract_cursor_1 = require("./abstract_cursor");
/** @public */
class RunCommandCursor e***REMOVED***tends abstract_cursor_1.AbstractCursor {
    /**
     * Controls the `getMore.comment` field
     * @param comment - any BSON value
     */
    setComment(comment) {
        this.getMoreOptions.comment = comment;
        return this;
    }
    /**
     * Controls the `getMore.ma***REMOVED***TimeMS` field. Only valid when cursor is tailable await
     * @param ma***REMOVED***TimeMS - the number of milliseconds to wait for new data
     */
    setMa***REMOVED***TimeMS(ma***REMOVED***TimeMS) {
        this.getMoreOptions.ma***REMOVED***AwaitTimeMS = ma***REMOVED***TimeMS;
        return this;
    }
    /**
     * Controls the `getMore.batchSize` field
     * @param ma***REMOVED***TimeMS - the number documents to return in the `ne***REMOVED***tBatch`
     */
    setBatchSize(batchSize) {
        this.getMoreOptions.batchSize = batchSize;
        return this;
    }
    /** Unsupported for RunCommandCursor */
    clone() {
        throw new error_1.MongoAPIError('Clone not supported, create a new cursor with db.runCursorCommand');
    }
    /** Unsupported for RunCommandCursor: readConcern must be configured directly on command document */
    withReadConcern(_) {
        throw new error_1.MongoAPIError('RunCommandCursor does not support readConcern it must be attached to the command being run');
    }
    /** Unsupported for RunCommandCursor: various cursor flags must be configured directly on command document */
    addCursorFlag(_, __) {
        throw new error_1.MongoAPIError('RunCommandCursor does not support cursor flags, they must be attached to the command being run');
    }
    /** Unsupported for RunCommandCursor: ma***REMOVED***TimeMS must be configured directly on command document */
    ma***REMOVED***TimeMS(_) {
        throw new error_1.MongoAPIError('ma***REMOVED***TimeMS must be configured on the command document directly, to configure getMore.ma***REMOVED***TimeMS use cursor.setMa***REMOVED***TimeMS()');
    }
    /** Unsupported for RunCommandCursor: batchSize must be configured directly on command document */
    batchSize(_) {
        throw new error_1.MongoAPIError('batchSize must be configured on the command document directly, to configure getMore.batchSize use cursor.setBatchSize()');
    }
    /** @internal */
    constructor(db, command, options = {}) {
        super(db.client, (0, utils_1.ns)(db.namespace), options);
        this.getMoreOptions = {};
        this.db = db;
        this.command = Object.freeze({ ...command });
    }
    /** @internal */
    async _initialize(session) {
        const operation = new run_command_1.RunCommandOperation(this.db, this.command, {
            ...this.cursorOptions,
            session: session,
            readPreference: this.cursorOptions.readPreference,
            responseType: responses_1.CursorResponse
        });
        const response = await (0, e***REMOVED***ecute_operation_1.e***REMOVED***ecuteOperation)(this.client, operation);
        return {
            server: operation.server,
            session,
            response
        };
    }
    /** @internal */
    async getMore(_batchSize) {
        // eslint-disable-ne***REMOVED***t-line @typescript-eslint/no-non-null-assertion
        const getMoreOperation = new get_more_1.GetMoreOperation(this.namespace, this.id, this.server, {
            ...this.cursorOptions,
            session: this.session,
            ...this.getMoreOptions
        });
        return await (0, e***REMOVED***ecute_operation_1.e***REMOVED***ecuteOperation)(this.client, getMoreOperation);
    }
}
e***REMOVED***ports.RunCommandCursor = RunCommandCursor;
//# sourceMappingURL=run_command_cursor.js.map